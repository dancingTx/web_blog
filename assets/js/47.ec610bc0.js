(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{482:function(_,v,t){"use strict";t.r(v);var e=t(0),d=Object(e.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"理解tcp的三次握手和四次挥手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理解tcp的三次握手和四次挥手","aria-hidden":"true"}},[_._v("#")]),_._v(" 理解TCP的三次握手和四次挥手")]),_._v(" "),t("h2",{attrs:{id:"osi7层网络模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#osi7层网络模型","aria-hidden":"true"}},[_._v("#")]),_._v(" "),t("code",[_._v("OSI")]),_._v("7层网络模型")]),_._v(" "),t("blockquote",[t("p",[_._v("OSI是"),t("code",[_._v("Open System Interconnection")]),_._v("的缩写，国际标准化组织（ISO）制定了OSI模型，该模型定义了不同计算机互联的标准，是设计和描述计算机网络通信的基本框架。")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("参考模型（从上至下）")]),_._v(" "),t("th",[_._v("各层含义")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("应用层")]),_._v(" "),t("td",[_._v("为应用程序提供给服务，如"),t("code",[_._v("HTTP,FTP,SMTP,POP3")]),_._v("等")])]),_._v(" "),t("tr",[t("td",[_._v("表示层")]),_._v(" "),t("td",[_._v("数据格式转换翻译、数据加密解密、压缩解压缩")])]),_._v(" "),t("tr",[t("td",[_._v("会话层")]),_._v(" "),t("td",[_._v("不同机器之间的用户建立及管理会话")])]),_._v(" "),t("tr",[t("td",[_._v("传输层")]),_._v(" "),t("td",[_._v("建立管理和维护端到端的连接，"),t("code",[_._v("TCP,UDP")])])]),_._v(" "),t("tr",[t("td",[_._v("网络层")]),_._v(" "),t("td",[t("code",[_._v("IP")]),_._v("地址及路由选择")])]),_._v(" "),t("tr",[t("td",[_._v("数据链路层")]),_._v(" "),t("td",[_._v("物理寻址，将原始比特流转化到逻辑传输线路")])]),_._v(" "),t("tr",[t("td",[_._v("物理层")]),_._v(" "),t("td",[_._v("机械、电子、定时接口通信信道上的原始比特流传输")])])])]),_._v(" "),t("h2",{attrs:{id:"_1-传输层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-传输层","aria-hidden":"true"}},[_._v("#")]),_._v(" 1.传输层")]),_._v(" "),t("blockquote",[t("p",[_._v("接受上一次的数据，将数据进行分割，保证数据准确到达对端。")])]),_._v(" "),t("h2",{attrs:{id:"_2-tcp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-tcp","aria-hidden":"true"}},[_._v("#")]),_._v(" 2.TCP")]),_._v(" "),t("blockquote",[t("p",[t("code",[_._v("TCP")]),_._v("是面向连接的无状态的协议。为了连接的可靠性，每次连接的建立都需要3次握手。")])]),_._v(" "),t("h3",{attrs:{id:"_1-建立连接（3次握手）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-建立连接（3次握手）","aria-hidden":"true"}},[_._v("#")]),_._v(" 1.建立连接（3次握手）")]),_._v(" "),t("blockquote",[t("p",[_._v("3次握手的目的：")]),_._v(" "),t("ul",[t("li",[_._v("同步连接对方的序列号和确认号；")]),_._v(" "),t("li",[_._v("交换"),t("code",[_._v("TCP")]),_._v("窗口大小的信息。")])])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("客户端（状态）")]),_._v(" "),t("th",[_._v("建立连接（三次握手）")]),_._v(" "),t("th",[_._v("服务端（状态）")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[t("code",[_._v("CLOSED")])]),_._v(" "),t("td"),_._v(" "),t("td",[t("code",[_._v("LISTEN")])])]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[t("code",[_._v("SYN seq=0")]),_._v(" ==>")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[t("code",[_._v("SYN_SEND")])]),_._v(" "),t("td"),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[_._v("<== "),t("code",[_._v("SYN ACK ack=1,seq=0")])]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td"),_._v(" "),t("td",[t("code",[_._v("SYN_RCVD")])])]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[t("code",[_._v("ACK ack=1,seq=1")]),_._v(" ==>")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[t("code",[_._v("ESTABLISHED")])]),_._v(" "),t("td"),_._v(" "),t("td",[t("code",[_._v("ESTABLISHED")])])])])]),_._v(" "),t("ul",[t("li",[_._v("第一次握手：建立连接。客户端发送连接请求，发送"),t("code",[_._v("SYN")]),_._v("报文，随机生成"),t("code",[_._v("seq")]),_._v("，本例默认为"),t("code",[_._v("0")]),_._v("。然后，客户端进入"),t("code",[_._v("SYN_SEND")]),_._v("状态，等待服务器的确认。")]),_._v(" "),t("li",[_._v("第二次握手：服务器收到客户端的"),t("code",[_._v("SYN")]),_._v("报文段。需要对这个"),t("code",[_._v("SYN")]),_._v("报文段进行确认，发送"),t("code",[_._v("ACK")]),_._v("报文，将"),t("code",[_._v("ack")]),_._v("设置为"),t("code",[_._v("1")]),_._v("（"),t("code",[_._v("ack")]),_._v("的值为对方"),t("code",[_._v("seq+1")]),_._v("或者"),t("code",[_._v("seq+L")]),_._v("(数据长度L)）。同时，自己还要发送"),t("code",[_._v("SYN")]),_._v("请求信息，将"),t("code",[_._v("seq")]),_._v("置为"),t("code",[_._v("0")]),_._v("。服务端将上述所有信息一并发送给客户端，此时服务器进入"),t("code",[_._v("SYN_RECV")]),_._v("状态。")]),_._v(" "),t("li",[_._v("第三次握手：客户端收到服务器的"),t("code",[_._v("ACK")]),_._v("和"),t("code",[_._v("SYN")]),_._v("报文后，进行确认，然后将"),t("code",[_._v("ack")]),_._v("设置为"),t("code",[_._v("1")]),_._v(","),t("code",[_._v("seq")]),_._v("设置为"),t("code",[_._v("1")]),_._v(",向服务器发送"),t("code",[_._v("ACK")]),_._v("报文段，这个报文段发送完毕以后，客户端和服务端都进入"),t("code",[_._v("ESTABLISHED")]),_._v("状态，完成"),t("code",[_._v("TCP")]),_._v("三次握手。")])]),_._v(" "),t("h3",{attrs:{id:"_2-数据传输"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-数据传输","aria-hidden":"true"}},[_._v("#")]),_._v(" 2.数据传输")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("客户端")]),_._v(" "),t("th",[_._v("数据传输")]),_._v(" "),t("th",[_._v("服务端")])])]),_._v(" "),t("tbody",[t("tr",[t("td"),_._v(" "),t("td",[t("code",[_._v("PSH seq=1,ACK ack=1(segmentLen = 99)")]),_._v(" ==>")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[_._v("<== "),t("code",[_._v("PSH seq=1,ACK ack=100(segmentLen = 119)")])]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[t("code",[_._v("ACK ack=120,seq=100")]),_._v(" ==>")]),_._v(" "),t("td")])])]),_._v(" "),t("ul",[t("li",[_._v("客户端先向服务器发送数据，该数据报是长度为99的数据。")]),_._v(" "),t("li",[_._v("服务器收到该报文后，也向客户端发送了一个数据进行确认（"),t("code",[_._v("ACK")]),_._v("),并且返回客户端要请求的数据，数据的长度为"),t("code",[_._v("111")]),_._v("，将"),t("code",[_._v("seq")]),_._v("设置为"),t("code",[_._v("1")]),_._v(","),t("code",[_._v("ack")]),_._v("设置为"),t("code",[_._v("120(1 + 119)")]),_._v("。")]),_._v(" "),t("li",[_._v("客户端收到服务器返回的数据后进行确认("),t("code",[_._v("ACK")]),_._v(")，将"),t("code",[_._v("seq")]),_._v("设置为"),t("code",[_._v("100")]),_._v(","),t("code",[_._v("ack")]),_._v("设置为"),t("code",[_._v("112(1 + 111)")]),_._v("。")])]),_._v(" "),t("h3",{attrs:{id:"_3-断开连接（4次挥手）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-断开连接（4次挥手）","aria-hidden":"true"}},[_._v("#")]),_._v(" 3.断开连接（4次挥手）")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("客户端（状态）")]),_._v(" "),t("th",[_._v("断开连接")]),_._v(" "),t("th",[_._v("服务端（状态）")])])]),_._v(" "),t("tbody",[t("tr",[t("td"),_._v(" "),t("td",[t("code",[_._v("FIN ACK ack=120,seq=100")]),_._v(" ==>")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[t("code",[_._v("FIN_WAIT_1")])]),_._v(" "),t("td"),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[_._v("<== "),t("code",[_._v("ACK ack=101,seq=120")])]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[t("code",[_._v("FIN_WAIT_2")])]),_._v(" "),t("td"),_._v(" "),t("td",[t("code",[_._v("CLOSE_WAIT")])])]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[_._v("<== "),t("code",[_._v("ACK ack=101,seq=120")])]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td"),_._v(" "),t("td",[t("code",[_._v("LAST_ACK")])])]),_._v(" "),t("tr",[t("td"),_._v(" "),t("td",[t("code",[_._v("ACK ack=121,seq=101")]),_._v(" ==>")]),_._v(" "),t("td")]),_._v(" "),t("tr",[t("td",[t("code",[_._v("TIME_WAIT")])]),_._v(" "),t("td"),_._v(" "),t("td",[t("code",[_._v("CLOSE")])])])])]),_._v(" "),t("ul",[t("li",[_._v("第一次挥手：客户端向服务器发送一个"),t("code",[_._v("FIN")]),_._v("报文段，将设置"),t("code",[_._v("seq")]),_._v("为"),t("code",[_._v("100")]),_._v("和"),t("code",[_._v("ack")]),_._v("为"),t("code",[_._v("120")]),_._v("，;此时，客户端进入 "),t("code",[_._v("FIN_WAIT_1")]),_._v("状态,这表示客户端没有数据要发送服务器了，请求关闭连接;")]),_._v(" "),t("li",[_._v("第二次挥手：服务器收到了客户端发送的"),t("code",[_._v("FIN")]),_._v("报文段，向客户端回一个"),t("code",[_._v("ACK")]),_._v("报文段，"),t("code",[_._v("ack")]),_._v("设置为"),t("code",[_._v("101")]),_._v("，"),t("code",[_._v("seq")]),_._v("设置为120;服务器进入了"),t("code",[_._v("CLOSE_WAIT")]),_._v("状态，客户端收到服务器返回的"),t("code",[_._v("ACK")]),_._v("报文后，进入"),t("code",[_._v("FIN_WAIT_2")]),_._v("状态;")]),_._v(" "),t("li",[_._v("第三次挥手：服务器会观察自己是否还有数据没有发送给客户端，如果有，先把数据发送给客户端，再发送FIN报文；如果没有，那么服务器直接发送"),t("code",[_._v("FIN")]),_._v("报文给客户端。请求关闭连接，同时服务器进入"),t("code",[_._v("LAST_ACK")]),_._v("状态;")]),_._v(" "),t("li",[_._v("第四次挥手：客户端收到服务器发送的"),t("code",[_._v("FIN")]),_._v("报文段，向服务器发送"),t("code",[_._v("ACK")]),_._v("报文段，将"),t("code",[_._v("seq")]),_._v("设置为"),t("code",[_._v("101")]),_._v("，将"),t("code",[_._v("ack")]),_._v("设置为"),t("code",[_._v("121")]),_._v("，然后客户端进入"),t("code",[_._v("TIME_WAIT")]),_._v("状态;服务器收到客户端的"),t("code",[_._v("ACK")]),_._v("报文段以后，就关闭连接;此时，客户端等待"),t("code",[_._v("2MSL")]),_._v("后依然没有收到回复，则证明"),t("code",[_._v("Server")]),_._v("端已正常关闭，客户端也可以关闭连接了。")])]),_._v(" "),t("blockquote",[t("p",[t("strong",[_._v("计算规则：")]),_._v("\nseq 为序列号\nack 为应答码\nseq = 对方上次的ack；（首次发送时seq为系统随机生成）\nack = 对方的seq+1（无数据传输时） 或者 seq+L（报文数据的长度L）")])]),_._v(" "),t("h2",{attrs:{id:"原文链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原文链接","aria-hidden":"true"}},[_._v("#")]),_._v(" 原文链接")]),_._v(" "),t("p",[t("a",{attrs:{href:"https://segmentfault.com/a/1190000014213178",target:"_blank",rel:"noopener noreferrer"}},[_._v("看图理解TCP的三次握手和四次挥手"),t("OutboundLink")],1)])])}),[],!1,null,null,null);v.default=d.exports}}]);