# ä¸ºä»€ä¹ˆä¼šå‡ºç°React Hooks?

![](./images/why-react-hooks.jpg)

> å½“ä½ è¦å­¦ä¹ ä¸€ä¸ªæ–°äº‹ç‰©çš„æ—¶å€™ï¼Œä½ åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯é—®è‡ªå·±ä¸¤ä¸ªé—®é¢˜

- ä¸ºä»€ä¹ˆä¼šå­˜åœ¨è¿™ä¸ªä¸œè¥¿ï¼Ÿ
- è¿™ä¸œè¥¿èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

å¦‚æœä½ ä»æ¥æ²¡æœ‰å¯¹è¿™ä¸¤ä¸ªé—®é¢˜éƒ½ç»™å‡ºä¸€ä¸ªä»¤äººä¿¡æœçš„ç­”æ¡ˆï¼Œé‚£ä¹ˆå½“ä½ æ·±å…¥åˆ°å…·ä½“é—®é¢˜æ—¶ï¼Œä½ å°±æ²¡æœ‰è¶³å¤Ÿçš„åšå®çš„åŸºç¡€ã€‚å…³äº React Hooksï¼Œè¿™äº›é—®é¢˜å€¼å¾—ä»¤äººæ€è€ƒã€‚å½“ Hooks å‘å¸ƒæ—¶ï¼ŒReact æ˜¯ JavaScript ç”Ÿæ€ç³»ç»Ÿä¸­æœ€æµè¡Œçš„ã€æœ€å—æ¬¢è¿çš„å‰ç«¯æ¡†æ¶ã€‚å°½ç®¡ React å·²ç»å—åˆ°é«˜åº¦èµæ‰¬ï¼ŒReact å›¢é˜Ÿä»ç„¶è®¤ä¸ºæœ‰å¿…è¦æ„å»ºå’Œå‘å¸ƒ Hooksã€‚åœ¨ä¸åŒçš„ Medium å¸–å­å’Œåšå®¢æ–‡ç« ä¸­çº·çº·è®®è®ºäº† 1.å°½ç®¡å—åˆ°é«˜åº¦èµæ‰¬å’Œå—æ¬¢è¿ï¼ŒReact å›¢é˜Ÿå†³å®šèŠ±è´¹å®è´µçš„çš„èµ„æºæ„å»ºå’Œå‘å¸ƒ Hooks æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿä»¥åŠ 2.å®ƒçš„å¥½å¤„ã€‚

ä¸ºäº†æ›´å¥½çš„ç†è§£è¿™ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ›´æ·±å…¥çš„äº†è§£æˆ‘ä»¬è¿‡å»æ˜¯å¦‚ä½•ç¼–å†™ React åº”ç”¨ç¨‹åºçš„ã€‚

## createClass

å¦‚æœä½ å·²ç»ä½¿ç”¨ React è¶³å¤Ÿä¹…ï¼Œä½ å°±ä¼šè®°å¾— React.createClassAPIã€‚è¿™æ˜¯æˆ‘ä»¬æœ€åˆåˆ›å»º React ç»„ä»¶çš„æ–¹å¼ã€‚ç”¨æ¥æè¿°ç»„ä»¶çš„æ‰€æœ‰ä¿¡æ¯éƒ½å°†ä½œä¸ºå¯¹è±¡ä¼ é€’ç»™`createClass`ã€‚

```react
const ReposGrid = React.createClass({
    getInitialState() {
        return {
            repos:[],
            loading:true
        }
    },
    componentDidMount() {
        this.updateRepos(this.props.id)
    },
    componentDidUpdate(prevProps) {
        if(prevProps.id !== this.props.id) {
            this.updateRepos(this.props.id)
        }
    },
    updateRepos(id) {
        this.setState({loading:true})
        
        fetchRepos(id)
        .then(repos=>this.setState({
            repos,
            loading: false
        }))
    },
    render() {
        const {loading, repos} = this.state
        
        if(loading) {
            return <Loading />
        }
        return (
        <ul>
        {
        	repos.map(({name,handle,stars,url})=>(
            	<li key={name}>
                	<ul>
                    	<li><a href={url}>{name}</a></li>
                        <li>@{handle}</li>
                        <li>{stars} stars</li>
                    </ul>
                </li>
            ))            
        }
        </ul>
        )
    }
})
```

`createClass`æ˜¯åˆ›å»º React ç»„ä»¶çš„ä¸€ç§ç®€å•è€Œåˆæœ‰æ•ˆçš„æ–¹æ³•ã€‚React æœ€åˆä½¿ç”¨`createClassAPI`çš„åŸå› æ˜¯ï¼Œå½“æ—¶ JavaScript æ²¡æœ‰å†…ç½®çš„ç±»ç³»ç»Ÿã€‚å½“ç„¶ï¼Œè¿™æœ€ç»ˆæ”¹å˜äº†ã€‚åœ¨ ES6 ä¸­ï¼ŒJavaScript å¼•å…¥äº†`class` å…³é”®å­—ï¼Œå¹¶ä»¥åŸç”Ÿçš„æ–¹å¼åœ¨ JavaScript ä¸­åˆ›å»ºç±»ã€‚è¿™è¿«ä½¿ React å¤„äºä¸€ç§è¿›é€€ä¸¤éš¾çš„åœ°æ­¥ã€‚è¦ä¹ˆç»§ç»­ä½¿ç”¨`createClass`ï¼Œå¯¹æŠ— JavaScript çš„å‘å±•ï¼Œè¦ä¹ˆéµå¾ªECMAScript æ ‡å‡†ï¼Œæ‹¥æŠ±ç±»ã€‚å†å²è¡¨æ˜ï¼Œä»–ä»¬é€‰æ‹©äº†åè€…ã€‚

## React.Component

> æˆ‘ä»¬å‘ç°æˆ‘ä»¬å¹¶ä¸æ˜¯æƒ³è¦å»è®¾è®¡ä¸€ä¸ªç±»ç³»ç»Ÿï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯æƒ³è¦ä»¥æƒ¯ç”¨çš„ JavaScript æ–¹æ³•æ¥åˆ›å»ºç±»ã€‚â€”â€” React v0.13.0 Release

React v0.13.0 ä¸­å¼•å…¥äº†React.Component APIï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»(ç°åœ¨)åŸç”Ÿ JavaScript ç±»ä¸­åˆ›å»º React ç»„ä»¶ã€‚è¿™æ˜¯ä¸€åœºå·¨å¤§çš„èƒœåˆ©ï¼Œå› ä¸ºå®ƒæ›´å¥½çš„ä¸ ECMAScript æ ‡å‡†ç»“åˆåœ¨äº†ä¸€èµ·ã€‚

```react
class ReposGrid extends React.Component {
    constructor(props) {
        super(props)
        this.state = {
            repos: [],
            loading: true
        }
        this.updateRepos = this.updateRepos.bind(this)
    }
	componentDidMount() {
        this.updateRepos(this.props.id)
    }
    componentDidUpdate(prevProps) {
        if(prevProps.id !== this.props.id) {
            this.updateRepos(this.props.id)
        }
    }
    updateRepos(id) {
        this.setState({loading: true})
        fetchRepos(id)
        .then(repos=> this.setState({
            loading: false,
            repos
        }))
    }
    render() {
        const {loading,repos} = this.state
       	if(loading) {
            return <Loading />
        }
        return (
    	<ul>
    		{
            	repos.map(({name,handle,stars,url})=>(
                	<li key={namem}>
                    	<ul>
                        	<li><a href={url}>{name}</a></li>
                            <li>@{handle}</li>
                            <li>{stars} stars</li>
                        </ul>
                    </li>
                ))
        	}
    	</ul>
    )
    }
}
```

å°½ç®¡æœç€æ­£ç¡®çš„æ–¹å‘è¿ˆå‡ºäº†æ˜ç¡®çš„ä¸€æ­¥ï¼Œä½†è¿˜æ˜¯è¦åšå‡ºååº”ã€‚React.Component ä¸æ˜¯æ²¡æœ‰å®ƒçš„æƒè¡¡ã€‚

## æ„é€ å‡½æ•°

ä½¿ç”¨ç±»ç»„ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨`constructor`æ–¹æ³•å†…éƒ¨å°†ç»„ä»¶çš„çŠ¶æ€åˆå§‹åŒ–ä¸ºå®ä¾‹(this)ä¸Šçš„ state å±æ€§ã€‚ä½†æ˜¯ï¼Œæ ¹æ® ECMAScript è§„èŒƒï¼Œå¦‚æœè¦æ‰©å±•å­ç±»(è¿™é‡ŒæŒ‡çš„æ˜¯ React.Component)ï¼Œå¿…é¡»å…ˆè°ƒç”¨`super`å±æ€§ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ thisã€‚å…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨ React æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è®°å¾—å°†`props`å±æ€§ä¼ é€’ç»™`super`ã€‚

```react
constructor (props) {
    super(props) // ğŸ¤®

    ...
  }
```

## è‡ªåŠ¨ç»‘å®š

å½“ä½¿ç”¨`createClass`æ—¶ï¼ŒReact ä¼šè‡ªåŠ¨å°†æ‰€æœ‰æ–¹æ³•ç»‘å®šåœ¨ç»„ä»¶çš„å®ä¾‹ä¸Šï¼Œä¹Ÿå°±æ˜¯ `this`ã€‚å½“æœ‰äº† React.Component åï¼Œæƒ…å†µå°±ä¸åŒäº†ã€‚å¾ˆå¿«ï¼Œå„åœ°çš„ React å¼€å‘äººå‘˜éƒ½æ„è¯†åˆ°äº†ä»–ä»¬ä¸çŸ¥é“`this`å…³é”®å­—æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬ä¸å¾—ä¸è®°ä½ç±»ä¸­çš„`constructor`ä¸­çš„`bind`æ–¹æ³•ã€‚å¦‚æœä½ ä¸è¿™æ ·åšï¼Œåˆ™ä¼šå‡ºç°ç»å¸¸å‡ºç°çš„é”™è¯¯ __Cannot read property `setState` of undefined__

```react
  constructor (props) {
    ...

    this.updateRepos = this.updateRepos.bind(this) // ğŸ˜­
  }
```

ç°åœ¨æˆ‘å¤§æ¦‚èƒ½çŒœåˆ°ä½ ä»¬åœ¨æƒ³ä»€ä¹ˆã€‚é¦–å…ˆï¼Œè¿™äº›é—®é¢˜ç›¸å½“è‚¤æµ…ã€‚å½“ç„¶ï¼Œè°ƒç”¨ super(props) å¹¶è®°ä½`bind`æ–¹æ³•æ˜¯ç›¸å½“çƒ¦äººçš„ã€‚ä½†è¿™é‡Œå…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆæ ¹æœ¬é”™è¯¯ã€‚å…¶æ¬¡ï¼Œè¿™äº›é—®é¢˜å¹¶ä¸åƒ JavaScript ç±»çš„è®¾è®¡æ–¹å¼é‚£æ ·ä¸¥é‡ã€‚å½“ç„¶è¿™ä¸¤ç‚¹éƒ½æ˜¯æ¯‹åº¸ç½®ç–‘çš„ã€‚ç„¶è€Œï¼Œå¯¹äºæˆ‘ä»¬å¼€å‘äººå‘˜æ¥è¯´ï¼Œå³ä¾¿æ˜¯å†æµ…æ˜¾çš„é—®é¢˜ï¼Œå½“ä½ ä¸€å¤©è¦å¤„ç† 20 å¤šæ¬¡ç”šè‡³æ›´å¤šçš„æ—¶å€™ï¼Œä¹Ÿä¼šå˜å¾—éå¸¸åŒæ¶ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ä» createClass åˆ‡æ¢åˆ° React.Component åä¸ä¹…ï¼Œç±»å­—æ®µå‡ºå°äº†ã€‚

## ç±»å­—æ®µ

ç±»å­—æ®µå…è®¸æˆ‘ä»¬ç›´æ¥å°†å®ä¾‹å±æ€§ä½œä¸ºå±æ€§æ·»åŠ åˆ°ç±»ä¸Šï¼Œè€Œæ— éœ€ä½¿ç”¨`constructor`ã€‚è¿™å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæ„å‘³ç€ï¼Œä½¿ç”¨ç±»å­—æ®µï¼Œæˆ‘ä»¬ä¹‹å‰æ‰€è®¨è®ºçš„ä¸¤ä¸ª`æµ…æ˜¾`çš„é—®é¢˜éƒ½å°†è¿åˆƒè€Œè§£ã€‚æˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨`constructor`æ¥è®¾ç½®ç»„ä»¶çš„åˆå§‹çŠ¶æ€ï¼Œä¹Ÿä¸å†éœ€è¦åœ¨`constructor`ä¸­ä½¿ç”¨`bind`å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸ºæ–¹æ³•ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚

```react
class ReposGrid extends React.Component {
  state = {
    repos: [],
    loading: true
  }
  componentDidMount () {
    this.updateRepos(this.props.id)
  }
  componentDidUpdate (prevProps) {
    if (prevProps.id !== this.props.id) {
      this.updateRepos(this.props.id)
    }
  }
  updateRepos = (id) => {
    this.setState({ loading: true })

    fetchRepos(id)
      .then((repos) => this.setState({
        repos,
        loading: false
      }))
  }
  render() {
    const { loading, repos } = this.state

    if (loading === true) {
      return <Loading />
    }

    return (
      <ul>
        {repos.map(({ name, handle, stars, url }) => (
          <li key={name}>
            <ul>
              <li><a href={url}>{name}</a></li>
              <li>@{handle}</li>
              <li>{stars} stars</li>
            </ul>
          </li>
        ))}
      </ul>
    )
  }
}
```

æ‰€æœ‰é—®é¢˜éƒ½è§£å†³äº†ï¼Œæ˜¯å—ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œå¹¶æ²¡æœ‰ã€‚ä»`createClass`åˆ° React.Component çš„è¿ç§»è¿‡ç¨‹ä¸­ï¼Œ

ç»„ä»¶å¸¦æœ‰ä¸€äº›æƒè¡¡ï¼Œä½†æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œç±»å­—æ®µç¡®å®è§£å†³äº†ä¸€äº›é—®é¢˜ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬æ‰€è§è¿‡çš„æ‰€æœ‰ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä»ç„¶å­˜åœ¨ç€ä¸€äº›æ›´æ·±åˆ»(ä½†å¾ˆå°‘æåŠ)çš„é—®é¢˜ã€‚

React çš„æ•´ä½“ç†å¿µæ—¶ï¼Œé€šè¿‡å°†åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºå¯ä»¥ç»„åˆåœ¨ä¸€èµ·çš„ç‹¬ç«‹ç»„ä»¶ï¼Œå¯ä»¥æ›´å¥½åœ°ç®¡ç†åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ã€‚æ­£æ˜¯è¿™ç§ç»„ä»¶æ¨¡å‹ä½¿å¾— React å¦‚æ­¤ä¼˜é›…ï¼Œä¹Ÿä½¿å¾— React å¦‚æ­¤çš„ç‹¬ä¸€æ— äºŒã€‚ç„¶è€Œï¼Œé—®é¢˜ä¸åœ¨äºç»„ä»¶æ¨¡å‹ï¼Œè€Œæ˜¯å¦‚ä½•å®ç°ç»„ä»¶æ¨¡å‹ã€‚

## é‡å¤é€»è¾‘

è¿‡å»ï¼Œæˆ‘ä»¬æ„å»ºçš„ React ç»„ä»¶çš„æ–¹å¼ä¸ç»„ä»¶çš„å£°æ˜å‘¨æœŸæ˜¯è€¦åˆçš„ã€‚è¿™ç§åˆ’åˆ†è‡ªç„¶è€Œç„¶çš„è¿«ä½¿æˆ‘ä»¬åœ¨æ•´ä¸ªç»„ä»¶ä¸­æ•£å¸ƒç€ç›¸å…³é€»è¾‘ã€‚åœ¨æˆ‘ä»¬çš„æ‰€ä½¿ç”¨çš„ ReposGrid ç»„ä»¶ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„äº†è§£åˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬éœ€è¦ä¸‰ä¸ªå•ç‹¬çš„æ–¹æ³•`componentDidMountã€componentDidUpdateå’ŒupdateRepos`æ¥å®Œæˆç›¸åŒçš„ä»»åŠ¡â€”â€”ä½¿`repos`ä¸ä»»ä½• `props.id`ä¿æŒåŒæ­¥ã€‚

```react
componentDidMount () {
    this.updateRepos(this.props.id)
  }
  componentDidUpdate (prevProps) {
    if (prevProps.id !== this.props.id) {
      this.updateRepos(this.props.id)
    }
  }
  updateRepos = (id) => {
    this.setState({ loading: true })

    fetchRepos(id)
      .then((repos) => this.setState({
        repos,
        loading: false
      }))
  }
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨æ–°çš„æ–¹å¼æ¥å¤„ç† React ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨ã€‚

## å…±äº«éå¯è§†é€»è¾‘

å½“ä½ åœ¨ React ä¸­è€ƒè™‘æ„å›¾æ—¶ï¼Œä½ å¾ˆæœ‰å¯èƒ½ä¼šè€ƒè™‘ UI æ„å›¾ã€‚è¿™æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œå› ä¸ºè¿™æ­£æ˜¯ React æ‰€æ“…é•¿çš„ã€‚

```react
view = fn(state)
```

å®é™…ä¸Šï¼Œæ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºä¸ä»…ä»…æ˜¯ UI å±‚é¢çš„ã€‚éœ€è¦ç»„åˆå’Œéå¯è§†é€»è¾‘çš„åœ°æ–¹å¹¶ä¸å°‘è§ã€‚ä½†æ˜¯ï¼Œå› ä¸º React å°† UI ä¸ç»„ä»¶è€¦åˆèµ·æ¥ï¼Œæ‰€ä»¥è¿™å¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒReact å¹¶æ²¡æœ‰ç»™å‡ºä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚

ç»§ç»­çœ‹æˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªåŒæ ·éœ€è¦`repos` çŠ¶æ€çš„ç»„ä»¶ã€‚ç°åœ¨ï¼Œè¯¥çŠ¶æ€å’Œå¤„ç†å®ƒçš„é€»è¾‘ä½äº ReposGrid ç»„ä»¶ä¸­ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•åšå‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å¤åˆ¶æ‰€æœ‰ç”¨äºè·å–å’Œå¤„ç†`repos`çš„é€»è¾‘ï¼Œå¹¶å°†å…¶ç²˜è´´åˆ°æ–°ç»„ä»¶ä¸­ã€‚å¬èµ·æ¥è¿˜ä¸é”™ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆã€‚ä¸€ä¸ªæ›´èªæ˜çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒå°è£…äº†æ‰€æœ‰çš„å…±äº«é€»è¾‘ï¼Œå¹¶å°†`loading`å’Œ`repos`ä½œä¸º`props`ä¼ é€’ç»™ä»»ä½•éœ€è¦å®ƒçš„ç»„ä»¶ã€‚

```react
function withRepos (Component) {
  return class WithRepos extends React.Component {
    state = {
      repos: [],
      loading: true
    }
    componentDidMount () {
      this.updateRepos(this.props.id)
    }
    componentDidUpdate (prevProps) {
      if (prevProps.id !== this.props.id) {
        this.updateRepos(this.props.id)
      }
    }
    updateRepos = (id) => {
      this.setState({ loading: true })

      fetchRepos(id)
        .then((repos) => this.setState({
          repos,
          loading: false
        }))
    }
    render () {
      return (
        <Component
          {...this.props}
          {...this.state}
        />
      )
    }
  }
}
```

å½“åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ç»„ä»¶éœ€è¦`repos`(æˆ–åŠ è½½)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å°è£…åœ¨ withRepos HOC ä¸­ã€‚

```react
// ReposGrid.js
function ReposGrid ({ loading, repos }) {
  ...
}

export default withRepos(ReposGrid)
```

```react
// Profile.js
function Profile ({ loading, repos }) {
  ...
}

export default withRepos(Profile)
```

è¿™æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”å®ƒåŠ ä¸Š Render Props ä¸€ç›´æ˜¯æœ€ä½³çš„å…±äº«éå¯è§†é€»è¾‘çš„è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œè¿™ä¸¤ç§æ¨¡å¼éƒ½æœ‰ä¸€äº›ç¼ºç‚¹ã€‚

é¦–å…ˆï¼Œå¦‚æœä½ ä¸å¤Ÿç†Ÿæ‚‰å®ƒä»¬(å³ä½¿ä½ ç†Ÿæ‚‰)ï¼Œä½ ä¼šæœ‰ç‚¹å‘æ‡µã€‚ä½¿ç”¨ withRepos  HOC ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä»¥æœ€ç»ˆå‘ˆç°çš„ç»„ä»¶ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä½†è¿”å›ä¸€ä¸ªæ–°çš„ç±»ç»„ä»¶ï¼Œè¿™å°±æ˜¯é€»è¾‘æ‰€åœ¨ã€‚ä¸€ä¸ªå¤šä¹ˆå¤æ‚çš„è¿‡ç¨‹å•Šã€‚æ¥ä¸‹æ¥ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨å¤šä¸ª HOCï¼Œåˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿä½ å¯ä»¥æƒ³è±¡ï¼Œå®ƒå¾ˆå¿«å°±å¤±æ§äº†ã€‚

```react
export default withHover(
  withTheme(
    withAuth(
      withRepos(Profile)
    )
  )
)
```

æ¯”è¿™æ›´ç³Ÿçš„æ˜¯æœ€ç»ˆå¾—åˆ°çš„ç»“æœã€‚HOCs(å’Œç±»ä¼¼çš„æ¨¡å¼)è¿«ä½¿æˆ‘ä»¬å¿…é¡»é‡æ–°æ„é€ å’ŒåŒ…è£…ç»„ä»¶ã€‚è¿™æœ€ç»ˆå¯èƒ½å¯¼è‡´`åŒ…è£…åœ°ç‹±`ï¼Œè¿™åˆä¸€æ¬¡ä½¿å®ƒæ›´éš¾éµå¾ªã€‚

```react
<WithHover>
  <WithTheme hovering={false}>
    <WithAuth hovering={false} theme='dark'>
      <WithRepos hovering={false} theme='dark' authed={true}>
        <Profile 
          id='JavaScript'
          loading={true} 
          repos={[]}
          authed={true}
          theme='dark'
          hovering={false}
        />
      </WithRepos>
    </WithAuth>
  <WithTheme>
</WithHover>
```

## ç°çŠ¶

è¿™å°±æ˜¯æˆ‘ä»¬æ‰€å¤„çš„ç°çŠ¶ã€‚

- React å¾ˆå—æ¬¢è¿ã€‚
- æˆ‘ä»¬ä¸º React ç»„ä»¶ä½¿ç”¨ç±»ï¼Œå› ä¸ºè¿™åœ¨å½“æ—¶å¾ˆæœ‰æ„ä¹‰ã€‚
- è°ƒç”¨`super(props)`å¾ˆçƒ¦äººã€‚
- æ²¡äººçŸ¥é“`this`æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚
- okï¼Œå†·é™ä¸€ä¸‹ã€‚æˆ‘çŸ¥é“ä½ æ˜ç™½`this`æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†å¯¹äºæœ‰äº›äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¿…è¦çš„éšœç¢ã€‚
- æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç»„ç»‡ç»„ä»¶è¿«ä½¿æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­æ•£å¸ƒç€ç›¸å…³çš„é€»è¾‘ã€‚
- React æ²¡æœ‰ç”¨äºå…±äº«éå¯è§†é€»è¾‘çš„è‰¯å¥½åŸè¯­ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„ç»„ä»¶ API æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒç®€å•ã€å¯ç»„åˆã€çµæ´»å’Œå¯æ‰©å±•ã€‚è¿™ä¸ªä»»åŠ¡å¾ˆè‰°å·¨ï¼Œä½†æ˜¯ React å›¢é˜Ÿè¿˜æ˜¯æˆåŠŸäº†ã€‚

## React Hooks

ä» React v0.14.0 å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºç»„ä»¶â€”â€”ç±»å’Œå‡½æ•°ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¦‚æœæˆ‘ä»¬çš„ç»„ä»¶æœ‰çŠ¶æ€æˆ–è€…éœ€è¦ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬å°±å¿…é¡»ä½¿ç”¨ç±»ã€‚å¦åˆ™ï¼Œå¦‚æœå®ƒåªæ˜¯æ¥å—`props`å¹¶å‘ˆç°ä¸€äº› UIï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‡½æ•°ã€‚

é‚£ä¹ˆï¼Œå¦‚æœä¸æ˜¯è¿™æ ·å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ç±»ï¼Œè€Œæ˜¯åªä½¿ç”¨å‡½æ•°ï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

> æœ‰æ—¶å€™ï¼Œä¼˜é›…çš„å®ç°åªæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ä¸æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œä¸æ˜¯ä¸€ä¸ªç±»ã€‚ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚åªæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚â€”â€” John Carmack. Oculus VR é¦–å¸­æŠ€æœ¯å®˜

å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æ·»åŠ åŠŸèƒ½ç»„ä»¶ï¼Œä½¿å…¶æ‹¥æœ‰çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„èƒ½åŠ›ï¼Œä½†æ˜¯å‡è®¾æˆ‘ä»¬è¿™æ ·åšäº†ï¼Œæˆ‘ä»¬åˆèƒ½å¾—åˆ°ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ

æˆ‘ä»¬ä¸å†éœ€è¦è°ƒç”¨`super(props)`ï¼Œä¸å†éœ€è¦æ‹…å¿ƒç»‘å®šæ–¹æ³•æˆ–`this`å…³é”®å­—ï¼Œä¹Ÿä¸å†éœ€è¦ä½¿ç”¨ç±»å­—æ®µã€‚æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„æ‰€æœ‰`è¡¨é¢`é—®é¢˜éƒ½ä¼šè§£å†³ã€‚

```react
(ãƒà²¥,_ï½£à²¥)ãƒå½¡ React.Component ğŸ—‘

function ãƒ¾(Åâ€¿Åâœ¿)
```

å¥½å§ï¼Œç°åœ¨ï¼Œæ›´æ£˜æ‰‹çš„é—®é¢˜æ‘†åœ¨é¢å‰ã€‚

- çŠ¶æ€
- ç”Ÿå‘½å‘¨æœŸå‡½æ•°
- å…±äº«éå¯è§†é€»è¾‘

### çŠ¶æ€

ç”±äºæˆ‘ä»¬ä¸å†ä½¿ç”¨ç±»æˆ–`this`ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–°çš„æ–¹æ³•æ¥æ·»åŠ å’Œç®¡ç†ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ã€‚React v16.8.0 é€šè¿‡ useState ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ç§æ–°æ–¹æ³•ã€‚

> useState æ˜¯æˆ‘ä»¬åœ¨æœ¬è¯¾ç¨‹ä¸­çœ‹åˆ°çš„ä¼—å¤š Hooks ä¸­çš„ç¬¬ä¸€ä¸ªã€‚è®©è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†åšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚åœ¨ä¹‹åçš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ›´åŠ æ·±å…¥çš„ç ”ç©¶ useState å’Œå…¶ä»–çš„ Hooksã€‚

useState åªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³çŠ¶æ€çš„åˆå§‹å€¼ã€‚å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€é¡¹æ˜¯çŠ¶æ€å—(ä¹Ÿå°±æ˜¯æ›´æ”¹åçš„çŠ¶æ€å€¼ï¼Œç±»ä¼¼äºåœ¨ this.stateä¸­å®šä¹‰çš„çŠ¶æ€å€¼)ï¼Œç¬¬äºŒé¡¹æ˜¯æ›´æ–°æ”¹çŠ¶æ€çš„å‡½æ•°(ç”¨æ¥æ”¹å˜çŠ¶æ€ï¼Œç±»ä¼¼äºthis.setState())ã€‚

```react
const loadingTuple = React.useState(true)
const loading = loadingTuple[0]
const setLoading = loadingTuple[1]

...

loading // true
setLoading(false)
loading // false
```

æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œå•ç‹¬è·å–æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å¹¶ä¸æ˜¯æœ€ä½³çš„å¼€å‘äººå‘˜ä½“éªŒã€‚è¿™æ˜¯ä¸ºäº†æ¼”ç¤º useState å¦‚ä½•è¿”å›æ•°ç»„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨æ•°ç»„ææ„çš„æ–¹å¼åœ¨ä¸€è¡Œä¸­è·å–å€¼ã€‚

```react
// const loadingTuple = React.useState(true)
// const loading = loadingTuple[0]
// const setLoading = loadingTuple[1]

const [ loading, setLoading ] = React.useState(true) // ğŸ‘Œ
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨æ–°å­¦ä¹ çš„æœ‰å…³äº useState é’©å­çš„çŸ¥è¯†æ¥æ›´æ–° ReposGrid ç»„ä»¶ã€‚

```react
function ReposGrid ({ id }) {
  const [ repos, setRepos ] = React.useState([])
  const [ loading, setLoading ] = React.useState(true)

  if (loading === true) {
    return <Loading />
  }

  return (
    <ul>
      {repos.map(({ name, handle, stars, url }) => (
        <li key={name}>
          <ul>
            <li><a href={url}>{name}</a></li>
            <li>@{handle}</li>
            <li>{stars} stars</li>
          </ul>
        </li>
      ))}
    </ul>
  )
}
```

- çŠ¶æ€ âœ…
- ç”Ÿå‘½å‘¨æœŸå‡½æ•°
- å…±äº«éå¯è§†é€»è¾‘

### ç”Ÿå‘½å‘¨æœŸå‡½æ•°

ç°åœ¨ï¼Œæœ‰äº›äº‹æƒ…å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°éš¾è¿‡(æˆ–å¼€å¿ƒ?)ã€‚åœ¨ä½¿ç”¨ React Hooks æ—¶ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½å¤Ÿå°†ä½ æ‰€çŸ¥é“çš„å…³äºä¼ ç»Ÿ React ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥åŠè¿™ç§æ€ç»´æ–¹å¼çš„æ‰€æœ‰ç›¸å…³çŸ¥è¯†éƒ½å¿˜æ‰ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†è€ƒè™‘ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜â€”â€”__è¿™ä¸ªã€ç”Ÿå‘½å‘¨æœŸã€‘åˆ’åˆ†è‡ªç„¶è€Œç„¶çš„è¿«ä½¿æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­æ•£å¸ƒç€ç›¸å…³çš„é€»è¾‘ã€‚__ç›¸åï¼Œè€ƒè™‘åŒæ­¥ã€‚

æ€è€ƒä¸€ä¸‹ä½ æ›¾ç»ä½¿ç”¨è¿‡çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚æ— è®ºæ˜¯è®¾ç½®ç»„ä»¶çš„åˆå§‹çŠ¶æ€ã€è·å–æ•°æ®ã€æ›´æ–°DOMï¼Œè¿˜æ˜¯åšä»»ä½•äº‹æƒ…â€”â€”æœ€ç»ˆç›®æ ‡æ€»æ˜¯åŒæ­¥ã€‚é€šå¸¸ï¼ŒåŒæ­¥ React land(API è¯·æ±‚ã€DOMç­‰)å¤–éƒ¨çš„å†…å®¹å’Œ React land(ç»„ä»¶çŠ¶æ€)å†…éƒ¨çš„å†…å®¹ï¼Œåä¹‹äº¦ç„¶ã€‚

å½“æˆ‘ä»¬è€ƒè™‘åŒæ­¥è€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ—¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†ç›¸å…³çš„é€»è¾‘ç‰‡æ®µç»„åˆåœ¨ä¸€èµ·ã€‚ä¸ºæ­¤ï¼ŒReact æä¾›äº†å¦ä¸€ä¸ªé’©å­â€”â€”useEffectã€‚

å®šä¹‰åï¼ŒuseEffect å…è®¸æ‚¨åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå¯é€‰æ•°ç»„ã€‚å‡½æ•°å®šä¹‰è¦è¿è¡Œå“ªäº›å‰¯ä½œç”¨ï¼Œ(å¯é€‰)æ•°ç»„å®šä¹‰ä½•æ—¶__é‡æ–°åŒæ­¥(æˆ–é‡æ–°è¿è¡Œ)__ç»“æœã€‚

æ³¨ï¼šè¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶åŠ è½½æœŸé—´é¦–æ¬¡è¿è¡Œï¼Œéšåé€šè¿‡ç›‘å¬å¯é€‰æ•°ç»„ä¸­ä¼ å…¥çš„å‚æ•°å˜åŒ–ï¼Œæ›´æ–°å‡½æ•°ä»¥é‡æ–°åŒæ­¥ã€‚

```react
React.useEffect(() => {
  document.title = `Hello, ${username}`
}, [username])
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¼ é€’ç»™ useEffect çš„å‡½æ•°å°†åœ¨ç”¨æˆ·åå‘ç”Ÿæ”¹å˜æ—¶è¿è¡Œã€‚å› æ­¤ï¼Œå°†æ–‡æ¡£çš„æ ‡é¢˜ä¸`Helloã€${username}`è§£æä¸ºå†…å®¹åŒæ­¥ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ä»£ç ä¸­çš„ useEffect é’©å­æ¥åŒæ­¥`repos`å’Œ fetchRepos API è¯·æ±‚ï¼Ÿ

```react
function ReposGrid ({ id }) {
  const [ repos, setRepos ] = React.useState([])
  const [ loading, setLoading ] = React.useState(true)

  React.useEffect(() => {
    setLoading(true)

    fetchRepos(id)
      .then((repos) => {
        setRepos(repos)
        setLoading(false)
      })
  }, [id])

  if (loading === true) {
    return <Loading />
  }

  return (
    <ul>
      {repos.map(({ name, handle, stars, url }) => (
        <li key={name}>
          <ul>
            <li><a href={url}>{name}</a></li>
            <li>@{handle}</li>
            <li>{stars} stars</li>
          </ul>
        </li>
      ))}
    </ul>
  )
}
```

å¾ˆé¡ºç•…ï¼Œä¸æ˜¯å—ï¼Ÿæˆ‘ä»¬å·²ç»æˆåŠŸçš„æ‘†è„±äº† React.Componentã€`constructor`ã€`super`ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å†åœ¨ç»„ä»¶ä¸­æ•£å¸ƒ(å’Œå¤åˆ¶)`effect`é€»è¾‘äº†ã€‚

- çŠ¶æ€âœ…
- ç”Ÿå‘½å‘¨æœŸå‡½æ•°âœ…
- å…±äº«éå¯è§†é€»è¾‘

### å…±äº«éå¯è§†é€»è¾‘

å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒReact å¯¹å…±äº«éå¯è§†é€»è¾‘æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆçš„åŸå› æ˜¯__React å°† UI å’Œç»„ä»¶è€¦åˆåœ¨äº†ä¸€èµ·__ã€‚è¿™å¯¼è‡´äº†åƒé«˜é˜¶ç»„ä»¶æˆ– Render Props è¿™æ ·è¿‡äºå¤æ‚çš„æ¨¡å¼ã€‚ç°åœ¨ä½ ä¸€å®šçŒœåˆ°äº†ï¼ŒHooks å¯¹æ­¤ä¹Ÿæœ‰äº†ä¸€ä¸ªç­”æ¡ˆã€‚ç„¶è€Œï¼Œè¿™å¯èƒ½è·Ÿä½ æƒ³è±¡ä¸­çš„æœ‰äº›å‡ºå…¥ã€‚å¹¶æ²¡æœ‰ä¸“é—¨ç”¨äºå…±äº«éå¯è§†é€»è¾‘çš„å†…ç½®é’©å­ï¼Œç›¸åï¼Œä½ å¯ä»¥åˆ›å»ºä¸ä»»ä½• UI è§£è€¦çš„è‡ªå®šä¹‰é’©å­ã€‚

é€šè¿‡åˆ›å»ºæˆ‘ä»¬è‡ªå·±è‡ªå®šä¹‰çš„ useRepos é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚è¿™ä¸ªé’©å­å°†æ¥å—æˆ‘ä»¬æƒ³è¦è·å–çš„ Repos çš„`id`ï¼Œå¹¶(ä¿ç•™ç±»ä¼¼çš„API)è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€é¡¹ä¸ºåŠ è½½çŠ¶æ€ï¼Œç¬¬äºŒé¡¹ä¸º Repos çŠ¶æ€ã€‚

```react
function useRepos (id) {
  const [ repos, setRepos ] = React.useState([])
  const [ loading, setLoading ] = React.useState(true)

  React.useEffect(() => {
    setLoading(true)

    fetchRepos(id)
      .then((repos) => {
        setRepos(repos)
        setLoading(false)
      })
  }, [id])

  return [ loading, repos ]
}
```

å¥½æ¶ˆæ¯æ˜¯ä»»ä½•ä¸è·å–`repos`ç›¸å…³çš„é€»è¾‘éƒ½å¯ä»¥åœ¨è¿™ä¸ªè‡ªå®šä¹‰é’©å­ä¸­æŠ½è±¡ã€‚ç°åœ¨ï¼Œä¸ç®¡æˆ‘ä»¬åœ¨å“ªä¸ªç»„ä»¶ä¸­ï¼Œå³ä½¿å®ƒæ˜¯éå¯è§†é€»è¾‘ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦æœ‰å…³`repos`çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ useRepos è‡ªå®šä¹‰é’©å­ã€‚

```react
function ReposGrid ({ id }) {
  const [ loading, repos ] = useRepos(id)

  ...
}
```

```react
function Profile ({ user }) {
  const [ loading, repos ] = useRepos(user.id)

  ...
}
```

- çŠ¶æ€âœ…
- ç”Ÿå‘½å‘¨æœŸå‡½æ•°âœ…
- å…±äº«éå¯è§†é€»è¾‘âœ…

## æ€»ç»“

Hooks çš„æ¨å¹¿ç†å¿µæ˜¯ä½ å¯ä»¥åœ¨åŠŸèƒ½ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€ã€‚å®é™…ä¸Šï¼ŒHooks çš„ä½œç”¨è¿œä¸æ­¢äºæ­¤ã€‚æ›´å¤šçš„æ˜¯å…³äºæ”¹è¿›ä»£ç é‡ç”¨ã€ç»„åˆå’Œæ›´å¥½çš„é»˜è®¤è®¾ç½®ã€‚æˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå…³äº Hooks çš„çŸ¥è¯†éœ€è¦å­¦ä¹ ï¼Œä½†æ˜¯ç°åœ¨ä½ å·²ç»çŸ¥é“äº†å®ƒä»¬å­˜åœ¨çš„åŸå› ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªåšå®çš„åŸºç¡€ã€‚

**æœ¬æ–‡æ ¹æ®è¯‘è€…ç†è§£ç¿»è¯‘ï¼Œå¦‚æœ‰éœ€è¦ï¼Œè¯·é˜…è¯»åŸæ–‡**

## åŸæ–‡é“¾æ¥

[Why React Hooks?](https://dev.to/tylermcginnis/why-react-hooks-51lj)