<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Flexible实现手淘H5页面的终端适配 | 前端菜鸟的进阶之路</title>
    <meta name="description" content="编程不易，砥砺前行">
    <link rel="icon" href="/web_blog/favicon.png">
    
    <link rel="preload" href="/web_blog/assets/css/0.styles.7a36dbfb.css" as="style"><link rel="preload" href="/web_blog/assets/js/app.91c2830f.js" as="script"><link rel="preload" href="/web_blog/assets/js/2.eab7b1a3.js" as="script"><link rel="preload" href="/web_blog/assets/js/7.bef0e458.js" as="script"><link rel="prefetch" href="/web_blog/assets/js/10.b7c51a89.js"><link rel="prefetch" href="/web_blog/assets/js/11.810ef8d7.js"><link rel="prefetch" href="/web_blog/assets/js/12.84690c1b.js"><link rel="prefetch" href="/web_blog/assets/js/13.014fa390.js"><link rel="prefetch" href="/web_blog/assets/js/14.b6a094b6.js"><link rel="prefetch" href="/web_blog/assets/js/15.73574f0c.js"><link rel="prefetch" href="/web_blog/assets/js/16.6d25e66c.js"><link rel="prefetch" href="/web_blog/assets/js/17.6da21962.js"><link rel="prefetch" href="/web_blog/assets/js/18.e4bbeb45.js"><link rel="prefetch" href="/web_blog/assets/js/19.9d29afb6.js"><link rel="prefetch" href="/web_blog/assets/js/20.6e359f8f.js"><link rel="prefetch" href="/web_blog/assets/js/21.b6a44bf0.js"><link rel="prefetch" href="/web_blog/assets/js/22.72395c6d.js"><link rel="prefetch" href="/web_blog/assets/js/23.3cf07315.js"><link rel="prefetch" href="/web_blog/assets/js/24.ce3af049.js"><link rel="prefetch" href="/web_blog/assets/js/25.be8464ab.js"><link rel="prefetch" href="/web_blog/assets/js/26.818e6723.js"><link rel="prefetch" href="/web_blog/assets/js/27.f604fd0e.js"><link rel="prefetch" href="/web_blog/assets/js/28.ea43a8e0.js"><link rel="prefetch" href="/web_blog/assets/js/29.6cbe154c.js"><link rel="prefetch" href="/web_blog/assets/js/3.79e8f6ea.js"><link rel="prefetch" href="/web_blog/assets/js/30.3cce892a.js"><link rel="prefetch" href="/web_blog/assets/js/31.eb02c772.js"><link rel="prefetch" href="/web_blog/assets/js/32.b6fc1c31.js"><link rel="prefetch" href="/web_blog/assets/js/33.ec19d2a3.js"><link rel="prefetch" href="/web_blog/assets/js/34.e7982556.js"><link rel="prefetch" href="/web_blog/assets/js/35.6a41dc93.js"><link rel="prefetch" href="/web_blog/assets/js/36.de0c92ff.js"><link rel="prefetch" href="/web_blog/assets/js/37.2a90e558.js"><link rel="prefetch" href="/web_blog/assets/js/38.9e70b18a.js"><link rel="prefetch" href="/web_blog/assets/js/39.89f71dfd.js"><link rel="prefetch" href="/web_blog/assets/js/4.25ef38aa.js"><link rel="prefetch" href="/web_blog/assets/js/40.e174e7e4.js"><link rel="prefetch" href="/web_blog/assets/js/41.db4885dc.js"><link rel="prefetch" href="/web_blog/assets/js/42.3319ecbf.js"><link rel="prefetch" href="/web_blog/assets/js/43.cc6ba545.js"><link rel="prefetch" href="/web_blog/assets/js/44.0b03addc.js"><link rel="prefetch" href="/web_blog/assets/js/45.7759f79c.js"><link rel="prefetch" href="/web_blog/assets/js/46.b64c0a3b.js"><link rel="prefetch" href="/web_blog/assets/js/47.ec610bc0.js"><link rel="prefetch" href="/web_blog/assets/js/48.1d911c4b.js"><link rel="prefetch" href="/web_blog/assets/js/49.6e433bb5.js"><link rel="prefetch" href="/web_blog/assets/js/5.746bcae1.js"><link rel="prefetch" href="/web_blog/assets/js/50.cae10208.js"><link rel="prefetch" href="/web_blog/assets/js/51.172c43fc.js"><link rel="prefetch" href="/web_blog/assets/js/52.2d0abb1b.js"><link rel="prefetch" href="/web_blog/assets/js/53.6601a9d1.js"><link rel="prefetch" href="/web_blog/assets/js/54.4db27d09.js"><link rel="prefetch" href="/web_blog/assets/js/55.b676ed30.js"><link rel="prefetch" href="/web_blog/assets/js/56.2f94d7d3.js"><link rel="prefetch" href="/web_blog/assets/js/57.739d9718.js"><link rel="prefetch" href="/web_blog/assets/js/58.14252a7f.js"><link rel="prefetch" href="/web_blog/assets/js/59.9c05cedd.js"><link rel="prefetch" href="/web_blog/assets/js/6.d8f4b14d.js"><link rel="prefetch" href="/web_blog/assets/js/60.10980736.js"><link rel="prefetch" href="/web_blog/assets/js/61.6dbb0bf2.js"><link rel="prefetch" href="/web_blog/assets/js/62.2b9de86f.js"><link rel="prefetch" href="/web_blog/assets/js/63.3c461591.js"><link rel="prefetch" href="/web_blog/assets/js/64.cb9c7ff9.js"><link rel="prefetch" href="/web_blog/assets/js/65.3027aedc.js"><link rel="prefetch" href="/web_blog/assets/js/66.8fa94b0b.js"><link rel="prefetch" href="/web_blog/assets/js/67.1196783a.js"><link rel="prefetch" href="/web_blog/assets/js/68.9e3adf92.js"><link rel="prefetch" href="/web_blog/assets/js/69.30b26df4.js"><link rel="prefetch" href="/web_blog/assets/js/70.ea55f415.js"><link rel="prefetch" href="/web_blog/assets/js/71.99deb135.js"><link rel="prefetch" href="/web_blog/assets/js/72.b411f500.js"><link rel="prefetch" href="/web_blog/assets/js/73.ae212902.js"><link rel="prefetch" href="/web_blog/assets/js/74.c42cb468.js"><link rel="prefetch" href="/web_blog/assets/js/75.4841d167.js"><link rel="prefetch" href="/web_blog/assets/js/76.8152f076.js"><link rel="prefetch" href="/web_blog/assets/js/77.5650be83.js"><link rel="prefetch" href="/web_blog/assets/js/78.13e5f2de.js"><link rel="prefetch" href="/web_blog/assets/js/79.981af0a6.js"><link rel="prefetch" href="/web_blog/assets/js/8.e30cf33c.js"><link rel="prefetch" href="/web_blog/assets/js/80.79c69641.js"><link rel="prefetch" href="/web_blog/assets/js/81.acfa7b78.js"><link rel="prefetch" href="/web_blog/assets/js/82.4422108d.js"><link rel="prefetch" href="/web_blog/assets/js/83.65d9e4db.js"><link rel="prefetch" href="/web_blog/assets/js/84.b8c62118.js"><link rel="prefetch" href="/web_blog/assets/js/9.ebc19581.js">
    <link rel="stylesheet" href="/web_blog/assets/css/0.styles.7a36dbfb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web_blog/" class="home-link router-link-active"><!----> <span class="site-name">前端菜鸟的进阶之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web_blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/web_blog/blog/" class="nav-link router-link-active">技术·博文</a></div><div class="nav-item"><a href="/web_blog/question/" class="nav-link">经典·面试</a></div> <a href="https://github.com/dancingTx/web_blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web_blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/web_blog/blog/" class="nav-link router-link-active">技术·博文</a></div><div class="nav-item"><a href="/web_blog/question/" class="nav-link">经典·面试</a></div> <a href="https://github.com/dancingTx/web_blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS知识汇总</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS框架-Vue篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS框架-React篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NPM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端自动化及工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>H5移动端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web_blog/blog/HTML5相关/H5移动端/基于淘宝弹性布局方案lib-flexible的问题研究.html" class="sidebar-link">基于淘宝弹性布局方案lib-flexible的问题研究</a></li><li><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html" class="active sidebar-link">使用Flexible实现手淘H5页面的终端适配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#目标" class="sidebar-link">目标</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#痛点" class="sidebar-link">痛点</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#手淘团队适配协作模式" class="sidebar-link">手淘团队适配协作模式</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#前端开发完成终端适配方案" class="sidebar-link">前端开发完成终端适配方案</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#案例实战" class="sidebar-link">案例实战</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#效果" class="sidebar-link">效果</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/HTML5相关/H5移动端/使用Flexible实现手淘H5页面的终端适配.html#原文链接" class="sidebar-link">原文链接</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>H5中的WebAPI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络协议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软技能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/web_blog/blog/声明.html" class="sidebar-link">声明</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用flexible实现手淘h5页面的终端适配"><a href="#使用flexible实现手淘h5页面的终端适配" aria-hidden="true" class="header-anchor">#</a> 使用Flexible实现手淘H5页面的终端适配</h1> <p>曾几何时为了兼容IE低版本浏览器而头痛，以为到了Mobile时代，就可以和这些麻烦事说再见了。可没想到，到了移动时代，为了处理各个终端的适配而乱了手脚。那么，<strong>手淘的H5是如何实现多终端适配的</strong></p> <h2 id="目标"><a href="#目标" aria-hidden="true" class="header-anchor">#</a> 目标</h2> <p>哪一个双十一的Mobile页面作案例，比如你实现一个类似下图的一个H5的页面：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d312e6a7067.88b6c660.jpg" alt=""></p> <p>目的明确，就是做一个这样的H5页面。</p> <h2 id="痛点"><a href="#痛点" aria-hidden="true" class="header-anchor">#</a> 痛点</h2> <p>虽然H5页面比之PC端的Web页面简单了不少，但是让我们头疼的时要想尽一切办法让页面能够适配众多不同的终端设备。看看下图，你就会知道，这是一件多么痛苦的事情了：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d342e706e67.352d5d9c.png" alt=""></p> <p>再来看看手淘H5要适配的终端设备数据：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d372e706e67.06df3eae.png" alt=""></p> <p>看到这些数据，是否死的心都有了，或者为此捏了一把汗。</p> <h2 id="手淘团队适配协作模式"><a href="#手淘团队适配协作模式" aria-hidden="true" class="header-anchor">#</a> 手淘团队适配协作模式</h2> <p>早期移动端开发，对于终端设备适配的问题只属于Android系列，只不过很多设计师常忽略Android适配问题，只出一套IOS平台的设计稿。但随着IPhone6，IPhone6+的出现，从此适配问题不再只属于Android系列了，也就是从这时候开始让移动端适配全面进入到了<code>杂屏</code>时代。</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d31312e706e67.6cb03dba.png" alt=""></p> <p>为了应对这么多的终端设备，设计师和前端开发之间又应该采用什么协作模式呢？</p> <p>而整个手淘设计师和前端开发的适配协作基本思路是：</p> <ul><li>选择一种尺寸作为设计和开发基准</li> <li>定义一套适配规则，自动适配剩下的两种尺寸(其实不仅两种)</li> <li>特殊适配效果给出设计效果</li></ul> <p>一图胜千言，下图是手淘团队适配协作模式：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d362e6a7067.36f17f31.jpg" alt=""></p> <p>在手淘的设计师与前端开发协作过程中：**手淘设计师常选择IPhone6作为基准设计尺寸，交付给前端的设计尺寸是按750px * 1334px 为准(高度会随着内容多少而改变)。前端开发人员通过一套适配规则自动适配到其他的尺寸。</p> <p>根据上面所说，设计师给我们的设计图是一个750px * 1600px 的页面：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d332e6a7067.862a92b0.jpg" alt=""></p> <h2 id="前端开发完成终端适配方案"><a href="#前端开发完成终端适配方案" aria-hidden="true" class="header-anchor">#</a> 前端开发完成终端适配方案</h2> <p>拿到设计师给的设计图后，剩下的事情就是前端开发人员的事了。而经过手淘多年的摸索与实战，总结了一套移动端适配的方案-flexible方案。</p> <p>首先，先来了解一些基本概念。</p> <p><strong>一些基本概念</strong></p> <ul><li><p><strong>视窗 viewport</strong></p> <p>简单的理解，viewport是严格等于浏览器的窗口。在桌面浏览器中，viewport就是浏览器窗口的宽度与高度。但在移动终端设备上会有点复杂。</p> <p>移动端的viewport太窄，为了能够更好地为CSS布局服务，所以提供了两个viewport:虚拟的viewport-<strong>visualviewport</strong>和布局的viewport-<strong>layoutviewport</strong>。</p> <p>而事实上，viewport 是一个很复杂的知识点。</p></li> <li><p><strong>物理像素(physical pixel)</strong></p> <p>物理像素又被称为设备像素，他是显示设备中一个最微小的物理部件。每个像素可以根据操作系统设置自己的颜色和亮度。正是这些设备像素的微小距离欺骗了我们肉眼看到的图像效果。</p></li> <li><p><strong>设备独立像素(density-independent pixel)</strong></p> <p>设备独立像素也称为密度无关像素，可以认为是计算机坐标系统中的一个点，这个点代表一个可以由程序使用的虚拟像素(比如CSS像素)，然后由相关系统转换成物理像素。</p></li> <li><p><strong>CSS像素</strong></p> <p>CSS像素是一个抽象的单位，主要用在浏览器端，用来精确度量Web页面上的内容。一般情况下，CSS像素称为与设备无关的像素(device-independent pixel)，简称DIPs。</p></li> <li><p><strong>屏幕密度</strong></p> <p>屏幕密度是指一个设备表面上存在的像素数量，它通常以每英寸有多少像素来计算(PPI)。</p></li> <li><p><strong>设备像素比(device pixel ratio)</strong></p> <p>设备像素比简称为dpr，其定义了物理像素和设备独立像素的对应关系。它的值可以按下面的公式计算得到:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>设备像素比 <span class="token operator">=</span> 物理像素<span class="token operator">/</span>设备独立像素
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在JavaScript中，可以通过window.devicePixelRatio获取当前设备的dpr。而在CSS中，可以通过-webkit-device-pixel-ratio，-webkit-min-device-pixel-ratio 和 -webkit-max-device-pixel-ratio 进行媒体查询，对不同dpr的设备，做一些样式适配(这里只针对webkit内核的浏览器和webview)。</p> <p>dip或dp(device independent pixels,设备独立像素)与屏幕密度有关。dip可以用来辅助区分视网膜设备还是非视网膜设备。</p> <p>综合上述概念，用一张图来解释：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f3230313231322f726574696e612d7765622d332e6a7067.f282825e.jpg" alt=""></p> <p>众所周知，IPhone6的设备宽度和高度为375pt * 667pt，可以理解为设备的独立像素；而其dpr为<code>2</code>，根据上面公式，我们可以很轻松的获取设备的物理像素为750pt * 1334pt。</p> <p>如下所示，某元素的CSS样式:</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token property">width</span><span class="token punctuation">:</span>2px<span class="token punctuation">;</span>
<span class="token property">height</span><span class="token punctuation">:</span>2px<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在不同的屏幕上，CSS像素所呈现的物理尺寸是一致的，而不同的是CSS像素所对应的物理像素具数是不一致的。在普通屏幕下，<code>1</code>个CSS像素对应<code>1</code>个物理像素，而在Retina屏幕下，<code>1</code>个CSS像素对应的却是<code>4</code>个物理像素。</p> <p>看到这里，你能感觉到，在移动端时代屏幕适配除了Layout之外，还要考虑到图片的适配，因为其直接影响到页面显示的质量，对于如何实现图片的适配，如下图所示:</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f3230313231322f726574696e612d7765622d31302e6a7067.a5b2ef43.jpg" alt=""></p></li> <li><p><strong>meta标签</strong></p> <p>&lt; meta &gt;标签有很多种，而这里要着重说的是viewport的<code>meta</code>标签，其主要用来告诉浏览器如何规范的渲染Web页面，而你则需要告诉它视窗有多大。在开发移动端页面时，我们需要设<code>meta</code>标签如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>viewport<span class="token punctuation">'</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>width=device-width,initial-scale=1,maximum-scale=1<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>代码以显示网页的屏幕宽度定义了视窗宽度。网页的比例和最大比例被设置为<code>100%</code>。</p> <p>留个悬念，因为后面的解决方案中需要重度依赖<code>meta</code>标签。</p></li> <li><p><strong>CSS单位rem</strong></p> <p>在W3C规范中是这样描述<code>rem</code>的：</p> <blockquote><p>font size of the root element.</p></blockquote> <p>简单的理解，<code>rem</code>就是相对于根元素</p><html>的<code>font-size</code>来做计算的。而我们的方案中使用<code>rem</code>单位，是能够轻易地根据<html>的<code>font-size</code>计算出元素的盒模型大小。而这个特色对我们来说相当有益处。<p></p></html></html></li></ul> <p><strong>前端实现方案</strong></p> <p>了解了前面的一些相关概念后，接下来看一看实际解决方案。在整个手淘团队中，有一个名为<code>lib-flexible</code>的库，而这个库就是用来解决H5页面终端适配的。</p> <p><strong>lib-flexible是什么？</strong></p> <p><code>lib-flexible</code>是一个制作H5适配的开源库，可以<a href="https://github.com/amfe/lib-flexible/archive/master.zip" target="_blank" rel="noopener noreferrer">点击这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载相关文件，获取需要的JS和CSS文件。</p> <p>当然也可以直接使用阿里CDN：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>http://g.tbcdn.cn/mtb/lib-flexible/{{version}}/??flexible_css.js,flexible.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将代码中的换成对应的版本号0.3.4。</p> <p><strong>使用方法</strong></p> <p><code>lib-flexible</code>库的使用方法非常的简单，只需要在Web页面的</p><head></head>中添加对应的<code>flexible_css.js,flexible.js</code>文件:<p></p> <p>第一种方法是将文件下载到自己的项目中，然后通过相对路径添加:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>build/flexible_css.debug.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>build/flexible.debug.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>或者直接加载阿里CDN的文件:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>另外强烈建议对JS做<strong>内联处理</strong>，尽可能早的执行该文件，以便于将后需用到的库做适配。执行这个JS后，会在</p><html>元素上增加一个<code>data-dpr</code>属性， 以及一个<code>font-size</code>样式。JS会根据不同的设备添加不同的<code>data-dpr</code>值，比如说是<code>2</code>或者<code>3</code>，同时会给<code>html</code>加上对应的<code>font-size</code>的值，比如说是<code>75px</code>。<p></p> <p>如此一来，页面中的元素，都可以通过<code>rem</code>单位来设置。他们会根据<code>html</code>元素的<code>font-size</code>值做相应的计算，从而实现屏幕的适配效果。除此之外，在引入<code>lib-flexible</code>需要执行的JS之前，可以手动设置<code>meta</code>来控制<code>dpr</code>值，如：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>flexible<span class="token punctuation">'</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>inital-dpr=2<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中<code>initial-dpr</code>会把<code>dpr</code>强制设置为给定的值。如果手动设置了<code>dpr</code>之后，不管设备是多少<code>dpr</code>，都会强制认为其<code>dpr</code>为你手动设置的值。因此不建议在引入<code>flexible</code>库后手动设置<code>dpr</code>，因为在<code>flexible</code>中，支队IOS设备进行了<code>dpr</code>的判断，对于Android系列，始终认为其<code>dpr</code>的值为<code>1</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> isAndroid <span class="token operator">=</span> win<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/android/gi</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> isIPhone <span class="token operator">=</span> win<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/iphone/gi</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> devicePixelRatio <span class="token operator">=</span> win<span class="token punctuation">.</span>devicePixelRatio
    <span class="token keyword">if</span><span class="token punctuation">(</span>isIPhone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// IOS下，对于2或者3的屏，yong2倍的方案，其余情况用1倍方案</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>devicePixelRatio <span class="token operator">&gt;=</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">||</span> dpr <span class="token operator">&gt;=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dpr <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>devicePixelRatio <span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">||</span> dpr <span class="token operator">&gt;=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dpr <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            dpr <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 除IOS外的其他设备，全部使用1倍方案</span>
        dpr <span class="token operator">=</span><span class="token number">1</span> 
    <span class="token punctuation">}</span>
    scale <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span>dpr
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>flexible的实质</strong></p> <p><code>flexible</code>实际上就是通过JS来动态更改<code>meta</code>标签，代码类似于这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> metaEL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'meta'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> scale <span class="token operator">=</span> isRetina <span class="token operator">?</span><span class="token number">.5</span><span class="token punctuation">:</span><span class="token number">1</span>
metaEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'viewport'</span><span class="token punctuation">)</span>
metaEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">initial-scale=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,maximum-scale=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,minimum-scale=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> wrap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    wrap<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wrap<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>​	事实上，它做了如下几件事情:</p> <ul><li>动态修改<meta>标签</li> <li>给<html>元素添加<code>data-dpr</code>属性，并且动态改写<code>data-dpr</code>的值</html></li> <li>给<html>元素添加到<code>font-size</code>属性，并且动态改写<code>font-size</code>的值</html></li></ul> <h2 id="案例实战"><a href="#案例实战" aria-hidden="true" class="header-anchor">#</a> 案例实战</h2> <p>了解flexible相关知识后，回到文章开头，目标是实现一个适配各个终端的H5页面。</p> <p><strong>创建HTML模板</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>en<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>utf-8<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>yes<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>apple-mobile-web-app-capable<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>yes<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>apple-touch-fullscreen<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>telephone=no,email=no<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>format-detection<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>apple-touch-icon<span class="token punctuation">'</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>favicon.png<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Shortcut Icon<span class="token punctuation">'</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>favicon.png<span class="token punctuation">'</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>image/x-icon<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>xx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 页面结构 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>正如之前所介绍的一样，优先加载flexible所需的配置：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个时候可以根据设计图的需求，在HTML文档中的</p><body></body>中添加对应的HTML结构，比如:<p></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>item-section<span class="token punctuation">'</span></span> <span class="token attr-name">data-repeat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>sections<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>item-section_header<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{bannerImg}<span class="token punctuation">'</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-repeat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>items<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>flag<span class="token punctuation">'</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>link<span class="token punctuation">'</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{itemLink}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
        	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>figure flag-item<span class="token punctuation">'</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{itemLink}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
            	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{imgSrc}<span class="token punctuation">'</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>figcaption flag-item<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>flag-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{itemLink}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{poductName}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>flag-price<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>双11价<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>¥{price}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">&gt;</span></span>({preferential})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>flag-type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{activityType}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>flag-btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{shopLink}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{activeName}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>这仅仅是一个示例文档，大家可以根据自己风格书写。</p> <p>为了更好的测试页面，给其配置一些假数据：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// define data </span>
<span class="token keyword">let</span> pageData <span class="token operator">=</span> <span class="token punctuation">{</span>
    sections<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">&quot;brannerImag&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;http://xxx.cdn.com/B1PNLZKXXXXXaTXXXXXXXXXXXX-750-481.jpg&quot;</span><span class="token punctuation">,</span>
        items<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token string">&quot;itemLink&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;##&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;imgSrc&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://placeimg.com/350/350/people/grayscale&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;poductName&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Carter's1年式灰色长袖连体衣包脚爬服全棉鲸鱼男婴儿童装115G093&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;299.06&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;preferential&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;满400减100&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;activityType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1小时内热卖5885件&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;shopLink&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;##&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;activeName&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;马上抢！&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>接下来就是美化工作了。在写具体样式之前，需要先了解几点。</p> <p><strong>把视觉稿中的px转换成rem</strong></p> <p>读到这里，大家应该都知道，我们接下来要做的事情，就是如何将视觉稿中的<code>px</code>转换成<code>rem</code>。</p> <p>首先，目前日常工作中，视觉设计师给到前端开发人员手中的视觉稿尺寸一般是基于<code>640px、750px</code>以及<code>1125px</code>宽度为基准的。至于为什么，是为了考虑Retina屏。</p> <p>正如文章开头的示例设计稿，它就是一张以<code>750px</code>为基准设计的。那么问题来了，我们如何将设计稿中的<code>px</code>转换成<code>rem</code>。</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d382e706e67.604359b9.png" alt=""></p> <p>目前，<code>flexible</code>会将视觉稿分成<strong>100份</strong>(主要是为了以后能够更好的兼容vh和vw)，而每一份被称为一个单位<code>a</code>。同时<code>1rem</code>单位被认定为<code>10a</code>。针对我们的这份视觉设计稿可以计算出:</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code>1a = 7.5px
1rem = 75px
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>那么我们这个示例的稿子就分成了<code>10a</code>，也就是整个宽度为<code>10rem</code>，</p><html>对应的<code>font-size</code>为<code>75px</code>:<p></p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d322e6a7067.37544f71.jpg" alt=""></p> <p>这样一来，对于视觉稿上的元素尺寸换算，只需要原始的<code>px</code>值➗<code>rem基准值</code>即可。例如此例视觉稿中的图片，其尺寸是<code>176px * 176px</code>,转换之后称为<code>2.34667rem * 2.34667rem</code>。</p> <p><strong>如何快速计算rem</strong></p> <p>在实际生产过程中，如果每一次计算<code>px</code>转换成<code>rem</code>，或许会觉得比较麻烦，获取会直接影响到开发效率。为了使开发人员有更好的开发体验，人们各施所长，开发了许多<code>px</code>转<code>rem</code>的小工具。</p> <p><strong>CSSREM</strong></p> <p>CSSREM是一个CSS的<code>px</code>值转<code>rem</code>值的Sublime自动完成的插件。先来看看插件的效果：</p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f63737372656d2e676966.b4a5ada9.gif" alt=""></p> <p><strong>CSS处理器</strong></p> <p>除了使用编辑器插件外，还可以使用CSS的处理器来帮助开发人员处理。比如Sass，Less以及PostCss这样的处理器。如下是几个简单例子：</p> <p><strong>Sass</strong></p> <p>使用Sass的开发人员，可以使用Sass的函数、混合宏等功能来实现:</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@function</span> <span class="token function">px2rem</span><span class="token punctuation">(</span>$px<span class="token punctuation">,</span>$<span class="token property">base-font</span><span class="token punctuation">:</span>16px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token atrule"><span class="token rule">@if</span> <span class="token punctuation">(</span><span class="token function">unitless</span><span class="token punctuation">(</span>$px<span class="token punctuation">)</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
        <span class="token atrule"><span class="token rule">@warn</span> 'Assuming #</span><span class="token punctuation">{</span>$px<span class="token punctuation">}</span> to be in pixels<span class="token punctuation">,</span> attempting to convert it into pixels for you'
        <span class="token atrule"><span class="token rule">@return</span> <span class="token function">px2rem</span><span class="token punctuation">(</span>$px+0px<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token rule">@else</span> if <span class="token punctuation">(</span><span class="token function">unit</span><span class="token punctuation">(</span>$px<span class="token punctuation">)</span> == em<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
                @return $px
    <span class="token punctuation">}</span> 
    @return <span class="token punctuation">(</span>$px/$base-font<span class="token punctuation">)</span>  *1em
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>除了使用Sass函数外，还可以使用Sass混合宏：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">px2rem</span><span class="token punctuation">(</span>$property<span class="token punctuation">,</span>$px-values<span class="token punctuation">,</span>$<span class="token property">baseline-px</span><span class="token punctuation">:</span>16px<span class="token punctuation">,</span>$<span class="token property">support-for-ie</span><span class="token punctuation">:</span>false<span class="token punctuation">)</span></span><span class="token punctuation">{</span>
    //Conver the baseline into rems
    $<span class="token property">baseline-rem</span><span class="token punctuation">:</span> $baseline-px / 1rem * 1<span class="token punctuation">;</span>
    //Print the first line in pixel values
    <span class="token atrule"><span class="token rule">@if</span> $support-for-ie</span> <span class="token punctuation">{</span>
        <span class="token selector">#</span><span class="token punctuation">{</span>$property<span class="token punctuation">}</span><span class="token punctuation">:</span> $px-values<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    //if there is only one <span class="token punctuation">(</span>numeric<span class="token punctuation">)</span> value<span class="token punctuation">,</span> return the property/value line for it.
    <span class="token atrule"><span class="token rule">@if</span> <span class="token function">type-of</span><span class="token punctuation">(</span>$px-values<span class="token punctuation">)</span> == <span class="token string">&quot;number&quot;</span></span><span class="token punctuation">{</span>
        <span class="token selector">#</span><span class="token punctuation">{</span>$property<span class="token punctuation">}</span><span class="token punctuation">:</span> $px-values / $baseline-rem<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token atrule"><span class="token rule">@else</span></span> <span class="token punctuation">{</span>
        //Create an empty list that we can dump values into
        $<span class="token property">rem-values</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token atrule"><span class="token rule">@each</span> $value in $px-values</span><span class="token punctuation">{</span>
            // If the value is zero or not a number<span class="token punctuation">,</span> return it
            <span class="token atrule"><span class="token rule">@if</span> $value == 0 or <span class="token function">type-of</span><span class="token punctuation">(</span>$value<span class="token punctuation">)</span> != <span class="token string">&quot;number&quot;</span></span><span class="token punctuation">{</span>
                $<span class="token property">rem-values</span><span class="token punctuation">:</span> <span class="token function">append</span><span class="token punctuation">(</span>$rem-values<span class="token punctuation">,</span> $value / $baseline-rem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token selector">// Return the property and its list of converted values
        #</span><span class="token punctuation">{</span>$property<span class="token punctuation">}</span><span class="token punctuation">:</span> $rem-values<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>PostCSS(px2rem)</strong></p> <p>除了Sass这样的CSS处理器以外，还有一款npm的工具px2rem。安装好px2rem后，可以在项目中直接使用。也可以使用PostCSS。使用PostCSS插件-postcss-px2rem:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> postcss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-postcss'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> px2rem <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-px2rem'</span><span class="token punctuation">)</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> processors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">px2rem</span><span class="token punctuation">(</span><span class="token punctuation">{</span>remUnit<span class="token punctuation">:</span><span class="token number">75</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./src/*.css'</span><span class="token punctuation">)</span>
    		  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">postcss</span><span class="token punctuation">(</span>processors<span class="token punctuation">)</span><span class="token punctuation">)</span>
    		  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./dest'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>除了在Gulp中配置外，还可以使用其他的配置方式。</p> <p>配置完成之后，在实际使用中，你只要像下面这样使用：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.selector</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span>150px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span>64px<span class="token punctuation">;</span> <span class="token comment">/*px*/</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span>28px<span class="token punctuation">;</span> <span class="token comment">/*px*/</span>
    <span class="token property">border</span><span class="token punctuation">:</span>1px solid #ddd<span class="token punctuation">;</span> <span class="token comment">/*no*/</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>px2rem处理后将会变成:</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.selector</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ddd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">[data-dpr=&quot;1&quot;] .selector</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">[data-dpr=&quot;2&quot;] .selector</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 64px<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 28px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">[data-dpr=&quot;3&quot;] .selector</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 96px<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 42px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在整个开发中有了这些工具后，完全不用担心<code>px</code>值转<code>rem</code>影响开发效率。</p> <p><strong>文本字号不建议使用rem</strong></p> <p>前面大家都见证了如何使用<code>rem</code>来完成H5适配。那么文本又将如何处理适配？是不是也通过<code>rem</code>来自动完成适配？</p> <p>显然，我们在IPhone3G和IPhone4的Retina屏下面，希望看到的文本字号是相同的。也就是说，<strong>我们不希望文本在Retina屏幕下变小</strong>,另外，我们<strong>希望在大屏手机中看到更多的文本</strong>，以及，现在绝大多数的字体文件都自带一些点阵尺寸，通常为<code>16px</code>和<code>24px</code>，所以我们<strong>不希望出现13px和15px这样的奇葩尺寸</strong>。</p> <p>如此一来，就决定了在制作H5的页面中，<code>rem</code>并不适合用到段落文本上。所以在<code>flexible</code>整个适配方案中，考虑文本还是使用<code>px</code>做单位，只不过使用<code>[data-dpr]</code>属性来区分不同<code>dpr</code>下的文本字号大小。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">div</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span>1rem<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span>.4rem<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span> // 默认写dpr为1的fontSize
<span class="token punctuation">}</span>
<span class="token selector">[data-dpr='2'] div</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span>24px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">[data-dpr='3'] div</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span>36px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>为了能更好的利于开发，在实际开发中，我们可以制定一个font-dpr()这样的Sass混合宏：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@mixin</span> <span class="token function">font-dpr</span><span class="token punctuation">(</span>$font-size<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span> <span class="token punctuation">:</span>$font-size<span class="token selector">;
    [data-dpr='2'] &amp;</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span>$font-size * 2
    <span class="token punctuation">}</span>
    <span class="token selector">[data-dpr='3'] &amp;</span> <span class="token punctuation">{</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span>$font-size * 3
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>有了这样的混合宏后，在开发中就可以直接使用:</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code>@inclue <span class="token function">font-dpr</span><span class="token punctuation">(</span>16px<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当然这只是针对描述性文本，比如说段落文本。但有的时候文本的字号也需要分场景，比如在项目中有一个slogan，业务方面希望这个slogan能根据不同的终端适配。针对这样的场景，完全可以使用rem给slogan做计量单位。</p> <p><strong>CSS</strong></p> <h2 id="效果"><a href="#效果" aria-hidden="true" class="header-anchor">#</a> 效果</h2> <p>最后来看看真机中显示的效果。</p> <p><strong>IPhone4</strong></p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d392e6a7067.a571c36d.jpg" alt=""></p> <p><strong>IPhone6+</strong></p> <p><img src="/web_blog/assets/img/687474703a2f2f7777772e773363706c75732e636f6d2f73697465732f64656661756c742f66696c65732f626c6f67732f323031352f313531312f72656d2d31302e706e67.75fa76e1.png" alt=""></p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>其实H5适配的方案有很多种，网上有关于这方面的教程也非常的多。不管哪种方法，都有其自己的优势和劣势。而本文主要介绍的是如何使用Flexible这样的一库来完成H5页面的终端适配。为什么推荐使用Flexible库来做H5页面的终端设备适配呢？主要因为这个库在手淘已经使用了近一年，而且已达到了较为稳定的状态。除此之外，你不需要考虑如何对元素进行折算，可以根据对应的视觉稿，直接切入。</p> <h2 id="原文链接"><a href="#原文链接" aria-hidden="true" class="header-anchor">#</a> 原文链接</h2> <p><a href="https://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html" target="_blank" rel="noopener noreferrer">使用Flexible实现手淘H5页面的终端适配<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></html></html></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/3/2019, 6:52:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web_blog/blog/HTML5相关/H5移动端/基于淘宝弹性布局方案lib-flexible的问题研究.html" class="prev">基于淘宝弹性布局方案lib-flexible的问题研究</a></span> <span class="next"><a href="/web_blog/blog/HTML5相关/H5中的WebAPI/[H5]FileReader.html">FileReader</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web_blog/assets/js/app.91c2830f.js" defer></script><script src="/web_blog/assets/js/2.eab7b1a3.js" defer></script><script src="/web_blog/assets/js/7.bef0e458.js" defer></script>
  </body>
</html>
