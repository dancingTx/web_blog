<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>爬虫，其实就是这么简单 | 前端菜鸟的进阶之路</title>
    <meta name="description" content="编程不易，砥砺前行">
    <link rel="icon" href="/web_blog/favicon.png">
    
    <link rel="preload" href="/web_blog/assets/css/0.styles.7a36dbfb.css" as="style"><link rel="preload" href="/web_blog/assets/js/app.91c2830f.js" as="script"><link rel="preload" href="/web_blog/assets/js/2.eab7b1a3.js" as="script"><link rel="preload" href="/web_blog/assets/js/5.746bcae1.js" as="script"><link rel="prefetch" href="/web_blog/assets/js/10.b7c51a89.js"><link rel="prefetch" href="/web_blog/assets/js/11.810ef8d7.js"><link rel="prefetch" href="/web_blog/assets/js/12.84690c1b.js"><link rel="prefetch" href="/web_blog/assets/js/13.014fa390.js"><link rel="prefetch" href="/web_blog/assets/js/14.b6a094b6.js"><link rel="prefetch" href="/web_blog/assets/js/15.73574f0c.js"><link rel="prefetch" href="/web_blog/assets/js/16.6d25e66c.js"><link rel="prefetch" href="/web_blog/assets/js/17.6da21962.js"><link rel="prefetch" href="/web_blog/assets/js/18.e4bbeb45.js"><link rel="prefetch" href="/web_blog/assets/js/19.9d29afb6.js"><link rel="prefetch" href="/web_blog/assets/js/20.6e359f8f.js"><link rel="prefetch" href="/web_blog/assets/js/21.b6a44bf0.js"><link rel="prefetch" href="/web_blog/assets/js/22.72395c6d.js"><link rel="prefetch" href="/web_blog/assets/js/23.3cf07315.js"><link rel="prefetch" href="/web_blog/assets/js/24.ce3af049.js"><link rel="prefetch" href="/web_blog/assets/js/25.be8464ab.js"><link rel="prefetch" href="/web_blog/assets/js/26.818e6723.js"><link rel="prefetch" href="/web_blog/assets/js/27.f604fd0e.js"><link rel="prefetch" href="/web_blog/assets/js/28.ea43a8e0.js"><link rel="prefetch" href="/web_blog/assets/js/29.6cbe154c.js"><link rel="prefetch" href="/web_blog/assets/js/3.79e8f6ea.js"><link rel="prefetch" href="/web_blog/assets/js/30.3cce892a.js"><link rel="prefetch" href="/web_blog/assets/js/31.eb02c772.js"><link rel="prefetch" href="/web_blog/assets/js/32.b6fc1c31.js"><link rel="prefetch" href="/web_blog/assets/js/33.ec19d2a3.js"><link rel="prefetch" href="/web_blog/assets/js/34.e7982556.js"><link rel="prefetch" href="/web_blog/assets/js/35.6a41dc93.js"><link rel="prefetch" href="/web_blog/assets/js/36.de0c92ff.js"><link rel="prefetch" href="/web_blog/assets/js/37.2a90e558.js"><link rel="prefetch" href="/web_blog/assets/js/38.9e70b18a.js"><link rel="prefetch" href="/web_blog/assets/js/39.89f71dfd.js"><link rel="prefetch" href="/web_blog/assets/js/4.25ef38aa.js"><link rel="prefetch" href="/web_blog/assets/js/40.e174e7e4.js"><link rel="prefetch" href="/web_blog/assets/js/41.db4885dc.js"><link rel="prefetch" href="/web_blog/assets/js/42.3319ecbf.js"><link rel="prefetch" href="/web_blog/assets/js/43.cc6ba545.js"><link rel="prefetch" href="/web_blog/assets/js/44.0b03addc.js"><link rel="prefetch" href="/web_blog/assets/js/45.7759f79c.js"><link rel="prefetch" href="/web_blog/assets/js/46.b64c0a3b.js"><link rel="prefetch" href="/web_blog/assets/js/47.ec610bc0.js"><link rel="prefetch" href="/web_blog/assets/js/48.1d911c4b.js"><link rel="prefetch" href="/web_blog/assets/js/49.6e433bb5.js"><link rel="prefetch" href="/web_blog/assets/js/50.cae10208.js"><link rel="prefetch" href="/web_blog/assets/js/51.172c43fc.js"><link rel="prefetch" href="/web_blog/assets/js/52.2d0abb1b.js"><link rel="prefetch" href="/web_blog/assets/js/53.6601a9d1.js"><link rel="prefetch" href="/web_blog/assets/js/54.4db27d09.js"><link rel="prefetch" href="/web_blog/assets/js/55.b676ed30.js"><link rel="prefetch" href="/web_blog/assets/js/56.2f94d7d3.js"><link rel="prefetch" href="/web_blog/assets/js/57.739d9718.js"><link rel="prefetch" href="/web_blog/assets/js/58.14252a7f.js"><link rel="prefetch" href="/web_blog/assets/js/59.9c05cedd.js"><link rel="prefetch" href="/web_blog/assets/js/6.d8f4b14d.js"><link rel="prefetch" href="/web_blog/assets/js/60.10980736.js"><link rel="prefetch" href="/web_blog/assets/js/61.6dbb0bf2.js"><link rel="prefetch" href="/web_blog/assets/js/62.2b9de86f.js"><link rel="prefetch" href="/web_blog/assets/js/63.3c461591.js"><link rel="prefetch" href="/web_blog/assets/js/64.cb9c7ff9.js"><link rel="prefetch" href="/web_blog/assets/js/65.3027aedc.js"><link rel="prefetch" href="/web_blog/assets/js/66.8fa94b0b.js"><link rel="prefetch" href="/web_blog/assets/js/67.1196783a.js"><link rel="prefetch" href="/web_blog/assets/js/68.9e3adf92.js"><link rel="prefetch" href="/web_blog/assets/js/69.30b26df4.js"><link rel="prefetch" href="/web_blog/assets/js/7.bef0e458.js"><link rel="prefetch" href="/web_blog/assets/js/70.ea55f415.js"><link rel="prefetch" href="/web_blog/assets/js/71.99deb135.js"><link rel="prefetch" href="/web_blog/assets/js/72.b411f500.js"><link rel="prefetch" href="/web_blog/assets/js/73.ae212902.js"><link rel="prefetch" href="/web_blog/assets/js/74.c42cb468.js"><link rel="prefetch" href="/web_blog/assets/js/75.4841d167.js"><link rel="prefetch" href="/web_blog/assets/js/76.8152f076.js"><link rel="prefetch" href="/web_blog/assets/js/77.5650be83.js"><link rel="prefetch" href="/web_blog/assets/js/78.13e5f2de.js"><link rel="prefetch" href="/web_blog/assets/js/79.981af0a6.js"><link rel="prefetch" href="/web_blog/assets/js/8.e30cf33c.js"><link rel="prefetch" href="/web_blog/assets/js/80.79c69641.js"><link rel="prefetch" href="/web_blog/assets/js/81.acfa7b78.js"><link rel="prefetch" href="/web_blog/assets/js/82.4422108d.js"><link rel="prefetch" href="/web_blog/assets/js/83.65d9e4db.js"><link rel="prefetch" href="/web_blog/assets/js/84.b8c62118.js"><link rel="prefetch" href="/web_blog/assets/js/9.ebc19581.js">
    <link rel="stylesheet" href="/web_blog/assets/css/0.styles.7a36dbfb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web_blog/" class="home-link router-link-active"><!----> <span class="site-name">前端菜鸟的进阶之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web_blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/web_blog/blog/" class="nav-link router-link-active">技术·博文</a></div><div class="nav-item"><a href="/web_blog/question/" class="nav-link">经典·面试</a></div> <a href="https://github.com/dancingTx/web_blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web_blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/web_blog/blog/" class="nav-link router-link-active">技术·博文</a></div><div class="nav-item"><a href="/web_blog/question/" class="nav-link">经典·面试</a></div> <a href="https://github.com/dancingTx/web_blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS知识汇总</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS框架-Vue篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS框架-React篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web_blog/blog/Node相关/用Node实现爬虫.html" class="active sidebar-link">爬虫，其实就是这么简单</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web_blog/blog/Node相关/用Node实现爬虫.html#爬虫及robots协议" class="sidebar-link">爬虫及Robots协议</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/Node相关/用Node实现爬虫.html#爬虫的基本流程" class="sidebar-link">爬虫的基本流程</a></li><li class="sidebar-sub-header"><a href="/web_blog/blog/Node相关/用Node实现爬虫.html#原文链接" class="sidebar-link">原文链接</a></li></ul></li><li><a href="/web_blog/blog/Node相关/用Node实现Mock服务器.html" class="sidebar-link">用 Node 实现 mock 数据服务器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NPM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端自动化及工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>H5移动端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>H5中的WebAPI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络协议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软技能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/web_blog/blog/声明.html" class="sidebar-link">声明</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="爬虫，其实就是这么简单"><a href="#爬虫，其实就是这么简单" aria-hidden="true" class="header-anchor">#</a> 爬虫，其实就是这么简单</h1> <h2 id="爬虫及robots协议"><a href="#爬虫及robots协议" aria-hidden="true" class="header-anchor">#</a> 爬虫及Robots协议</h2> <blockquote><p><strong>爬虫</strong>，是一种自动获取网页内容的程序。是搜索引擎的重要组成部门，因此搜索引擎去优化很大程度上就是针对爬虫而做出的优化。</p></blockquote> <blockquote><p><strong>Robots协议</strong>（也称为爬虫协议、机器人协议等）的全称是“网络爬虫排除标准”（Robots Exclusion Protocol），网站通过Robots协议告诉搜索引擎哪些页面可以抓取，哪些页面不能抓取。</p></blockquote> <p>robots.txt 文件是一个文本文件，使用任何一种常用的文本编辑器都可以创建和编辑它。robots.txt 是一种协议，而不是一个命令。robots.txt是搜索引擎访问网站时要查看的第一个文件，它告诉爬虫在服务器上什么文件是可以被查看的。</p> <p>下图是<strong>豆瓣电影</strong>页面关于 robots 协议列出的可以访问的范围。</p> <p><img src="/web_blog/assets/img/16c9ae430bbfd83f.e4cd8ff6.e4cd8ff6.jpg" alt="img"></p> <p>爬虫和 Robots 协议是紧密相连的，图中看到的不允许爬的页面就不可以去爬，如果涉及到用户的隐私问题，被发现后就会被起诉。</p> <p>因此业界普遍认可 Robots 协议，当然也存在无视协议强行爬取的情况，本文不做详解，如有兴趣，可以查看<a href="https://baike.baidu.com/item/robots%E5%8D%8F%E8%AE%AE/2483797#7_1" target="_blank" rel="noopener noreferrer">Robots 协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>通过下图，简单梳理一下所说内容。</p> <p><img src="/web_blog/assets/img/16c9af1438d01b17.ffc43255.ffc43255.jpg" alt="img"></p> <p>虽然上文进行了简要概括，但是可能还是会不明白，爬虫到底<strong>爬的是什么</strong>？</p> <p>其实简单来说，就是爬虫获取了某个特定页面的一段<strong>html代码</strong>，这对前端<code>er</code>来并不陌生，只是需要我们将它<strong>转换成Dom树</strong>即可。</p> <p>接下来，再看一下上图中的右半部分，这是一张<strong>对比图</strong></p> <p><strong>左边</strong>是<strong>没有</strong>限定<strong>Robots协议</strong>的，正常情况下，类似<code>admin/private</code>以及<code>tmp</code>这三个文件夹是不允许爬取的，但是由于没有<strong>Robots协议</strong>，爬虫可以肆无忌惮的爬取。</p> <p>而<strong>右边</strong>是经过<strong>Robots协议</strong>限定的，与之相反，像<code>Google</code>这种大型搜索引擎也是通过<strong>Robots协议</strong>文件去查看爬取内容的，因此查看到存在<code>admin/private</code>相关的文件夹就会直接跳过。</p> <h2 id="爬虫的基本流程"><a href="#爬虫的基本流程" aria-hidden="true" class="header-anchor">#</a> 爬虫的基本流程</h2> <p>简单来说，爬虫的流程无外乎就以下几点：</p> <ul><li>爬取数据</li> <li>数据入库</li> <li>启动服务</li> <li>渲染数据</li></ul> <h3 id="爬取数据"><a href="#爬取数据" aria-hidden="true" class="header-anchor">#</a> 爬取数据</h3> <p>接下来通过代码演示来爬取豆瓣电影页面的电影相关数据。</p> <p>下图是整体的目录结构。</p> <p><img src="data:image/jpeg;base64,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" alt="img"></p> <p>既然是<strong>爬取数据</strong>，就需要用到比较出名的工具------- <strong>Request</strong></p> <h4 id="request"><a href="#request" aria-hidden="true" class="header-anchor">#</a> Request</h4> <p>那么，<strong>Request</strong>到底如何使用呢？看官方代码感受一下。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'http://www.google.com'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> response<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 发生错误打印错误日志</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 响应成功打印状态码</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'statusCode:'</span><span class="token punctuation">,</span> response <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 打印Google页面的html 代码体</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'body:'</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>是不是简单易用？既然<strong>html</strong>页面已经抓取完毕，那么就只需要将其转变为<strong>Dom</strong>即可。</p> <p>接下来需要用到另外一个工具----<strong>cheeio</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'&lt;h2 class=&quot;title&quot;&gt;Hello world&lt;/h2&gt;'</span><span class="token punctuation">)</span>
 
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'h2.title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Hello there!'</span><span class="token punctuation">)</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'welcome'</span><span class="token punctuation">)</span>
 
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;h2 class=&quot;title welcome&quot;&gt;Hello there!&lt;/h2&gt;&lt;/body&gt;&lt;/html&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>看了上面的代码是否有一种似曾相识的感觉？这不就是<strong>JQuery</strong>吗？对，它被开发人员称为<strong>Node</strong>界的<strong>JQuery</strong>。</p> <p>既然页面有了，Dom结构也获取到了，那么就开始写爬虫吧。</p> <h4 id="读取内容"><a href="#读取内容" aria-hidden="true" class="header-anchor">#</a> 读取内容</h4> <p>首先根据豆瓣电影的页面进行分析，观察那些是正在热映的电影，先来查看它的<strong>Dom</strong>结构。</p> <p><img src="/web_blog/assets/img/16c9f5a4442a98b3.b4afe66f.b4afe66f.jpg" alt="img"></p> <p>需要的信息已经标注完毕，接下来进入<code>read.js</code>文件中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// read.js</span>

<span class="token comment">// require-promise 让request 可以支持promise写法，类似的库还有request-promise-native,request-promise-any等，需要注意的是这些库依赖于request，因此在下载这些库时务必也要下载request库</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request-promise'</span><span class="token punctuation">)</span>
<span class="token comment">// 将抓取的html 代码转换为可操作的dom</span>
<span class="token keyword">const</span> cheeio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheeio'</span><span class="token punctuation">)</span>
<span class="token comment">// debug库，用来在调试阶段查看日志</span>
<span class="token comment">// 最后在运行程序时debug不起作用时，可以在 package.json 中的 scripts 中加入这样一句话：</span>
<span class="token comment">//   &quot;debug&quot;: &quot;@powershell -Command $env:DEBUG='*';node xxx.js&quot;</span>
<span class="token comment">// xxx 为启动服务的主文件名</span>
<span class="token keyword">const</span> debug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'movie:read'</span><span class="token punctuation">)</span>

<span class="token comment">// 读取页面</span>
<span class="token keyword">const</span> <span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">url</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'开始读取最近上映的电影'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">,</span> <span class="token comment">// 要爬取的目标页面</span>
        <span class="token function-variable function">transform</span><span class="token punctuation">:</span> <span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// body 为目标页面抓取到的html代码</span>
            <span class="token comment">// 通过 cheerio.load() 方法将html代码转换成可操作的Dom 结构</span>
            <span class="token keyword">return</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">$</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 接收数据的空数组</span>
        
        <span class="token comment">//遍历热映电影的li</span>
        <span class="token comment">// 观察页面结构，不同页面标签不尽相同</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#screening li.ui-silde-item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> $ele <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token comment">//$ele.data() 可以获取页面中data开头的自定义属性</span>
            <span class="token keyword">const</span> name <span class="token operator">=</span> $ele<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> score <span class="token operator">=</span> $ele<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'rate'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'暂无评分'</span>
            <span class="token keyword">const</span> href <span class="token operator">=</span> $ele<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.poster a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> image <span class="token operator">=</span> $ele<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
            <span class="token comment">// 影片的相关id可以从href中获取</span>
            <span class="token keyword">const</span> id <span class="token operator">=</span> href <span class="token operator">&amp;&amp;</span> href<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token regex">/d+)/</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment">// 为了防止豆瓣防盗链导致裂图，换成 webp 格式加载图片</span>
            image <span class="token operator">=</span> image <span class="token operator">**</span> image<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/jpg$/</span><span class="token punctuation">,</span><span class="token string">'webp'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span>image <span class="token operator">||</span> <span class="token operator">!</span> href<span class="token punctuation">)</span> <span class="token keyword">return</span>
            
            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                name<span class="token punctuation">,</span>score<span class="token punctuation">,</span>href<span class="token punctuation">,</span>image<span class="token punctuation">,</span>id
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">正在读取电影：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> read
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>简单梳理一下上述代码做了什么：</p> <ul><li>通过<strong>request</strong>抓取<code>url</code>页面的<code>html</code>代码</li> <li><strong>cheerio</strong>将<code>html</code>转换成了<code>dom</code></li> <li>将所需的内容<strong>存入数组</strong>（名称|评分|地址|图片|id）</li> <li>返回数组并导出<code>read</code>方法</li></ul> <h3 id="数据入库"><a href="#数据入库" aria-hidden="true" class="header-anchor">#</a> 数据入库</h3> <p>这里通过<strong>mysql</strong>建立数据库用以储存数据。</p> <p>首先安装<strong>XAMPP</strong>和<strong>Navicat</strong>可视化数据库管理工具。</p> <h4 id="xampp启动mysql"><a href="#xampp启动mysql" aria-hidden="true" class="header-anchor">#</a> XAMPP启动mysql</h4> <p><img src="/web_blog/assets/img/16c9f60101689d39.201f90c7.201f90c7.jpg" alt="img"></p> <h4 id="navicat链接数据库以及建表"><a href="#navicat链接数据库以及建表" aria-hidden="true" class="header-anchor">#</a> Navicat链接数据库以及建表</h4> <p><img src="/web_blog/assets/img/16c9f828f43fa381.34691d6f.34691d6f.jpg" alt="img"></p> <p><img src="/web_blog/assets/img/16c9f657a5976124.c58f09f7.c58f09f7.jpg" alt="img"></p> <p><img src="/web_blog/assets/img/16c9f731416e693c.4989ef91.4989ef91.jpg" alt="img"></p> <p><img src="/web_blog/assets/img/16c9f7f5f6485572.7dac30b4.7dac30b4.jpg" alt="img"></p> <p><img src="/web_blog/assets/img/16c9f7f858b05b14.dd1ab4e0.dd1ab4e0.jpg" alt="img"></p> <p><img src="/web_blog/assets/img/16c9f81b36336a4d.9d446c0c.9d446c0c.jpg" alt="img"></p> <p>这一部分图有点多，但胜在简洁明了，接下来继续编码。</p> <h4 id="连接数据库"><a href="#连接数据库" aria-hidden="true" class="header-anchor">#</a> 连接数据库</h4> <p>首先，在<code>src</code>目录文件夹下创建一个<code>sql</code>文件，这里创建的文件要与数据库同名，因此叫它<code>my_movie.sql</code>。</p> <p>接下来编写连接数据库的代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// db.js</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span>
<span class="token comment">// bluebird 方便支持 promise 语义化</span>
<span class="token keyword">const</span> bluebird <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'bluebird'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建连接</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    host<span class="token punctuation">:</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token comment">// 主机地址 需要与数据库一致</span>
    port<span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span> <span class="token comment">// 端口号</span>
    database<span class="token punctuation">:</span> <span class="token string">'my_movie'</span><span class="token punctuation">,</span> <span class="token comment">//需要连接的数据库</span>
    user<span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token comment">// 数据库用户名</span>
    password<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token comment">// 数据库密码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 导出数据</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> bluebird<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>数据库创建和连接已经完成，接下来就是将获取的数据导入数据库中。</p> <h4 id="写入数据库"><a href="#写入数据库" aria-hidden="true" class="header-anchor">#</a> 写入数据库</h4> <p>打开<code>write.js</code>文件。编写写入数据库的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// write.js</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./db'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> debug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'movie:write'</span><span class="token punctuation">)</span>

<span class="token comment">// 写入数据库的方法 </span>
<span class="token keyword">const</span> <span class="token function-variable function">write</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">moives</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'开始写入电影'</span><span class="token punctuation">)</span>
    
    <span class="token comment">// movies 即为 read.js 中读取到的 result 数组</span>
    movies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>href<span class="token punctuation">,</span>image<span class="token punctuation">,</span>score</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过 query 查询 数据库中是否存在该条数据</span>
        <span class="token keyword">const</span> old_movies <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from movies where id=? limit 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment">// sql 查询语句返回一个数组，如果数组不为空，说明之前存在过数据，</span>
        
        <span class="token comment">// 有数据进行更新</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>old_movies<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> old_movies<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 将当前数据进行更新</span>
            <span class="token keyword">const</span> old_movie <span class="token operator">=</span> old_movies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">update movies set name=?,href=?,image=?,score=? where id=?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">[</span>
                name<span class="token punctuation">,</span>href<span class="token punctuation">,</span>image<span class="token punctuation">,</span>score<span class="token punctuation">,</span>old_movie<span class="token punctuation">.</span>id
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 没有数据则将数据直接插入到数据表中</span>
            <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">insert into movies(id,name,href,image,score) values(?,?,?,?,?)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">[</span>
                id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>href<span class="token punctuation">,</span>image<span class="token punctuation">,</span>score
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">正在写入电影：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> write
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>上述代码做了什么：</p> <ul><li>引入<code>query</code>方法来进行SQL语句书写</li> <li>遍历读取到的<code>movies</code>结果数组</li> <li>查询数据是否存在
<ul><li>存在：更新该项数据</li> <li>不存在：插入一条新数据</li></ul></li></ul> <p><img src="/web_blog/assets/img/20190821175721.17af95ab.png" alt=""></p> <p>写完了引入数据库的方法后，来简单i讲解一下SQL语句，毕竟SQL语句是大部分前端<code>er</code>的痛点。</p> <h4 id="sql-语句"><a href="#sql-语句" aria-hidden="true" class="header-anchor">#</a> SQL 语句</h4> <p>在上述的<code>sql</code>中存在着许多<code>?</code>标识符，这里的<code>?</code>表示占位符，也可以将数据直接写在<code>sql</code>语句中，但一般来说，因为数据比较敏感，为防止遭受SQL注入攻击，因此建议采用<code>?</code>占位符。</p> <p>说到<strong>SQL</strong>，就不得不说它的四大方法-----<strong>增删改查</strong></p> <ol><li><p>插入数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 语法：</span>
	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名<span class="token punctuation">(</span>列名<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>列名对应值<span class="token punctuation">)</span>
<span class="token comment"># 示例：</span>
	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">table</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>id<span class="token punctuation">,</span>url<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'爬虫'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'https://news.so.com/hotnews'</span><span class="token punctuation">)</span>
<span class="token comment"># 解释：</span>
	向<span class="token keyword">table</span>表中插入一条数据，数据的信息为 名字，id，访问地址 以及 相对应的各项数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>更新数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 语法</span>
	<span class="token keyword">UPDATE</span> 表名 <span class="token keyword">SET</span> 列名<span class="token operator">=</span>更新值 <span class="token keyword">WHERE</span> 更新条件
<span class="token comment"># 示例：</span>
	<span class="token keyword">UPDATE</span> articles <span class="token keyword">SET</span> title<span class="token operator">=</span><span class="token string">'你好，世界'</span><span class="token punctuation">,</span>content<span class="token operator">=</span><span class="token string">'世界没你想的那么糟！'</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 解释：</span>
	更新id为<span class="token number">1</span>的文章，标题和内容都想进行了修改
<span class="token comment"># 注意：更新数据时务必加上更新条件，否则会将库中所有数据都进行更新</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>删除数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 语法：</span>
    <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 表名 <span class="token keyword">WHERE</span> 删除条件
<span class="token comment"># 示例：</span>
    <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> tags <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">11</span>
<span class="token comment"># 解释：</span>
    从标签表<span class="token punctuation">(</span>tags<span class="token punctuation">)</span>里删除id为<span class="token number">11</span>的数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>查询数据(查询数据比较繁琐，此处只写简单语法，如感兴趣，可以学习一下<code>sql</code>语句)</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>语法：
    <span class="token keyword">SELECT</span> 列名 <span class="token keyword">FROM</span> 表名 <span class="token keyword">WHERE</span> 查询条件 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 排序列名
栗子：
    <span class="token keyword">SELECT</span> name<span class="token punctuation">,</span>title<span class="token punctuation">,</span>content <span class="token keyword">FROM</span> tags <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">8</span>
解释：
    查询id为<span class="token number">8</span>的标签表里对应信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>讲述了一下，接下来回归正题，开始检验代码成果。</p></li></ol> <h4 id="执行读写操作"><a href="#执行读写操作" aria-hidden="true" class="header-anchor">#</a> 执行读写操作</h4> <p>通过<code>index.js</code>页面，将<code>read.js</code>和<code>write.js</code>联系起来。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>

<span class="token keyword">const</span> read <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./read'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> write <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./write'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://movie.douban.com'</span> <span class="token comment">// 目标页面</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异步抓取目标页面</span>
    <span class="token keyword">const</span> movies <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">read</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token comment">// 写入数据到数据库</span>
    <span class="token keyword">await</span> <span class="token function">write</span><span class="token punctuation">(</span>movies<span class="token punctuation">)</span>
    <span class="token comment">// 程序执行完毕，退出</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>下图为执行结果</p> <p><img src="/web_blog/assets/img/16ca53d5b6262974.9fc67a36.9fc67a36.jpg" alt="img"></p> <p>接下来查看数据库中是否已经导入数据。</p> <p><img src="/web_blog/assets/img/16ca54282a043388.8efc157f.8efc157f.jpg" alt="img"></p> <p>可以看到数据已经成功导入到数据库中。</p> <p>但是，似乎还缺少点什么？</p> <p>接下来，我们通过简单的页面渲染，将我们爬取到的数据渲染到浏览器中。</p> <h3 id="启动服务"><a href="#启动服务" aria-hidden="true" class="header-anchor">#</a> 启动服务</h3> <p>接下来，开始创建一个<code>server</code>服务。</p> <h4 id="server服务"><a href="#server服务" aria-hidden="true" class="header-anchor">#</a> server服务</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// server.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> debug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'server'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/db'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> serve <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 设置渲染模板引擎</span>
serve<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span><span class="token string">'html'</span><span class="token punctuation">)</span>
serve<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'views'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
serve<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__express<span class="token punctuation">)</span>

<span class="token comment">// 首页路由</span>
serve<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过sql查询语句获取movies表中的数据</span>
   	<span class="token keyword">const</span> movies <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select * from movies'</span><span class="token punctuation">)</span>
    <span class="token comment">// 渲染首页模板将 movies 中的数据传递进去</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>movies<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听端口</span>
serve<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'server running at port 3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><code>server.js</code>完成后，最后编写<code>index.html</code>页面，将传递给该页面的数据渲染出来。</p> <h3 id="渲染数据"><a href="#渲染数据" aria-hidden="true" class="header-anchor">#</a> 渲染数据</h3> <div class="language-ejs line-numbers-mode"><pre class="language-ejs"><code>// index.html

<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>热映的电影<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>caption<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>正在热映的电影<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>movies<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
                <span class="token keyword">let</span> movie <span class="token operator">=</span> movies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>  
            </span><span class="token delimiter punctuation">%&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript">movie<span class="token punctuation">.</span>href</span><span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript">movie<span class="token punctuation">.</span>image</span><span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript">movie<span class="token punctuation">.</span>name</span><span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>score<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>评分：<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript">movie<span class="token punctuation">.</span>score</span><span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">}</span> </span><span class="token delimiter punctuation">%&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>通过模板引擎遍历<code>movies</code>数组，将数据展示在页面中。</p> <p>大功告成，接下来，查看一下渲染结果。</p> <p><img src="/web_blog/assets/img/16ca55d6ce64fa1f.27f93ba7.27f93ba7.jpg" alt="img"></p> <p>以上就是关于Node爬虫的全部内容,跟着代码一步一步敲完,也算是对爬虫有了一个基本的了解。</p> <h2 id="原文链接"><a href="#原文链接" aria-hidden="true" class="header-anchor">#</a> 原文链接</h2> <p><a href="https://juejin.im/post/5ac9bc56f265da238c3af18f" target="_blank" rel="noopener noreferrer">爬虫，其实本就是这么简单<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.npmjs.com/package/debug" target="_blank" rel="noopener noreferrer">npm-debug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.npmjs.com/package/cheerio" target="_blank" rel="noopener noreferrer">npm-cheerio<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.npmjs.com/package/request" target="_blank" rel="noopener noreferrer">npm-request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/27/2019, 3:34:23 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web_blog/blog/React相关/新手入坑迷点解疑.html" class="prev">新手学习 React 易迷惑的点</a></span> <span class="next"><a href="/web_blog/blog/Node相关/用Node实现Mock服务器.html">用 Node 实现 mock 数据服务器</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web_blog/assets/js/app.91c2830f.js" defer></script><script src="/web_blog/assets/js/2.eab7b1a3.js" defer></script><script src="/web_blog/assets/js/5.746bcae1.js" defer></script>
  </body>
</html>
